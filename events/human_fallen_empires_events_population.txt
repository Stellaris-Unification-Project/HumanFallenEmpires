namespace = human_fallen_empires_population

# set modifiler on planet by pop by on actions
pop_event = {
	id = human_fallen_empires_population.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
		exists = planet
	}

	immediate = {
		planet = {
			planet_event = {
				id = human_fallen_empires_population.1
			}
		}
	}
}

# set modifiler on planet by on actions
planet_event = {
	id = human_fallen_empires_population.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
	}

	immediate = {
		planet_event = {
			id = human_fallen_empires_population.2
		}
		planet_event = {
			id = human_fallen_empires_population.3
		}
		planet_event = {
			id = human_fallen_empires_population.4
		}
		planet_event = {
			id = human_fallen_empires_population.5
		}
	}
}

# set overpopulated modifiler on planet
planet_event = {
	id = human_fallen_empires_population.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles < 2
		not = {
			has_modifier = human_fallen_empires_population_overpopulated_planet
		}
		exists = owner
		owner = {
			is_country_type = default
		}
		pop_percentage = {
			percentage > 0.5
			limit = {
				is_robot_pop = no
			}
		}
	}

	immediate = {
		add_modifier = {
			modifier = human_fallen_empires_population_overpopulated_planet
			days = -1
		}
	}
}

# remove overpopulated modifiler on planet
planet_event = {
	id = human_fallen_empires_population.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles > 1
		has_modifier = human_fallen_empires_population_overpopulated_planet
	}

	immediate = {
		remove_modifier = human_fallen_empires_population_overpopulated_planet
	}
}

# set unpopulated modifiler on planet
planet_event = {
	id = human_fallen_empires_population.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles > 4
		not = {
			has_modifier = human_fallen_empires_population_unpopulated_planet
		}
		exists = owner
		owner = {
			is_country_type = default
			human_fallen_empires_trigger_is_hive = no
		}
	}

	immediate = {
		add_modifier = {
			modifier = human_fallen_empires_population_unpopulated_planet
			days = -1
		}
	}
}

# remove unpopulated modifiler on planet
planet_event = {
	id = human_fallen_empires_population.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles < 5
		has_modifier = human_fallen_empires_population_unpopulated_planet
	}

	immediate = {
		remove_modifier = human_fallen_empires_population_unpopulated_planet
	}
}

# remove pop from planet after colony ship build
ship_event = {
	id = human_fallen_empires_population.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
		is_ship_class = shipclass_colonizer
	}

	immediate = {
		if = {
			limit = {
				exists = orbit.planet
			}
			orbit.planet = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = root.species
						is_growing = no
					}
					kill_pop = yes
				}
			}
			else = {
				solar_system = {
					random_system_planet = {
						limit = {
							exists = owner
							any_owned_pop = {
								is_exact_same_species = root.species
								is_growing = no
							}
						}
						random_owned_pop = {
							limit = {
								is_exact_same_species = root.species
								is_growing = no
							}
							kill_pop = yes
						}
					}
				}
			}
		}
	}
}

# remove modifiers on_planet_ownerless
planet_event = {
	id = human_fallen_empires_population.7
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		or = {
			has_modifier = human_fallen_empires_population_unpopulated_planet
			has_modifier = human_fallen_empires_population_overpopulated_planet
		}
	}

	immediate = {
		remove_modifier = human_fallen_empires_population_unpopulated_planet
		remove_modifier = human_fallen_empires_population_overpopulated_planet
	}
}

# remove pop_was_enslaved modifier
pop_event = {
	id = human_fallen_empires_population.11
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
		or = {
			has_ethic = ethic_authoritarian
			and = {
				has_ethic = ethic_spiritualist
				exists = owner
				owner = {
					has_spiritualist_government = yes
				}
			}
		}
	}

	immediate = {
		remove_modifier = pop_was_enslaved
	}
}


# change main species 50 - 100
country_event = {
	id = human_fallen_empires_population.50
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		num_pops > 0
		not = {
			any_owned_pop_species = {
				is_exact_same_species = root
			}
		}
	}

	immediate = {
		random_owned_pop = {
			limit = {
				is_same_species = root
				root = {
					pop_percentage = {
						percentage > 0.5
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				is_same_species = root
				root = {
					pop_percentage = {
						percentage > 0.4
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				is_same_species = root
				root = {
					pop_percentage = {
						percentage > 0.3
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				is_same_species = root
				root = {
					pop_percentage = {
						percentage > 0.2
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				is_same_species = root
				root = {
					pop_percentage = {
						percentage > 0.1
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				is_same_species = root
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				root = {
					pop_percentage = {
						percentage > 0.5
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				root = {
					pop_percentage = {
						percentage > 0.4
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				root = {
					pop_percentage = {
						percentage > 0.3
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				root = {
					pop_percentage = {
						percentage > 0.2
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			limit = {
				root = {
					pop_percentage = {
						percentage > 0.1
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
		if = {
			limit = {
				has_country_flag = human_fallen_empires_population.50.stop
			}
			break = yes
		}
		random_owned_pop = {
			root = {
				change_dominant_species = {
					species = prev
				}
				set_timed_country_flag = {
					flag = human_fallen_empires_population.50.stop
					days = 10
				}
			}
		}
	}
}
