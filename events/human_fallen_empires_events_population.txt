namespace = human_fallen_empires_population

# set modifier on planet by pop by on actions
pop_event = {
	id = human_fallen_empires_population.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
		exists = planet
	}

	immediate = {
		planet = {
			planet_event = {
				id = human_fallen_empires_population.1
			}
		}
	}
}

# set modifier on planet by on actions
planet_event = {
	id = human_fallen_empires_population.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
	}

	immediate = {
		planet_event = {
			id = human_fallen_empires_population.2
		}
		planet_event = {
			id = human_fallen_empires_population.3
		}
		planet_event = {
			id = human_fallen_empires_population.4
		}
		planet_event = {
			id = human_fallen_empires_population.5
		}
	}
}

# set overpopulated modifier on planet
planet_event = {
	id = human_fallen_empires_population.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles < 2
		not = {
			has_modifier = human_fallen_empires_population_overpopulated_planet
		}
		exists = owner
		owner = {
			is_country_type = default
		}
		pop_percentage = {
			percentage > 0.5
			limit = {
				is_robot_pop = no
			}
		}
	}

	immediate = {
		add_modifier = {
			modifier = human_fallen_empires_population_overpopulated_planet
			days = -1
		}
	}
}

# remove overpopulated modifier on planet
planet_event = {
	id = human_fallen_empires_population.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles > 1
		has_modifier = human_fallen_empires_population_overpopulated_planet
	}

	immediate = {
		remove_modifier = human_fallen_empires_population_overpopulated_planet
	}
}

# set unpopulated modifier on planet
planet_event = {
	id = human_fallen_empires_population.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles > 4
		not = {
			has_modifier = human_fallen_empires_population_unpopulated_planet
		}
		exists = owner
		owner = {
			is_country_type = default
			human_fallen_empires_trigger_is_hive = no
		}
	}

	immediate = {
		add_modifier = {
			modifier = human_fallen_empires_population_unpopulated_planet
			days = -1
		}
	}
}

# remove unpopulated modifier on planet
planet_event = {
	id = human_fallen_empires_population.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		free_pop_tiles < 5
		has_modifier = human_fallen_empires_population_unpopulated_planet
	}

	immediate = {
		remove_modifier = human_fallen_empires_population_unpopulated_planet
	}
}

# remove pop from planet after colony ship build
ship_event = {
	id = human_fallen_empires_population.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
		is_ship_class = shipclass_colonizer
	}

	immediate = {
		if = {
			limit = {
				exists = orbit.planet
			}
			orbit.planet = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = root
						is_growing = no
					}
					kill_pop = yes
				}
			}
		}
		else = {
			solar_system = {
				random_system_planet = {
					limit = {
						exists = owner
						any_owned_pop = {
							is_exact_same_species = root
							is_growing = no
						}
					}
					random_owned_pop = {
						limit = {
							is_exact_same_species = root
							is_growing = no
						}
						kill_pop = yes
					}
				}
			}
		}
	}
}

# remove modifiers on_planet_ownerless
planet_event = {
	id = human_fallen_empires_population.7
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		or = {
			has_modifier = human_fallen_empires_population_unpopulated_planet
			has_modifier = human_fallen_empires_population_overpopulated_planet
		}
	}

	immediate = {
		remove_modifier = human_fallen_empires_population_unpopulated_planet
		remove_modifier = human_fallen_empires_population_overpopulated_planet
	}
}

# remove pop_was_enslaved modifier
pop_event = {
	id = human_fallen_empires_population.11
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_population_disable
		}
		or = {
			has_ethic = ethic_authoritarian
			and = {
				has_ethic = ethic_spiritualist
				exists = owner
				owner = {
					has_spiritualist_government = yes
				}
			}
		}
	}

	immediate = {
		remove_modifier = pop_was_enslaved
	}
}

# change main species 50
country_event = {
	id = human_fallen_empires_population.50
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		num_pops > 0
		not = {
			any_owned_pop_species = {
				is_exact_same_species = root
			}
		}
	}

	immediate = {
		random_owned_pop_species = {
			limit = {
				is_same_species = root
				root = {
					pop_percentage = {
						percentage > 0.5
						limit = {
							is_exact_same_species = prev
						}
					}
				}
			}
			save_event_target_as = human_fallen_empires_population_species
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					is_same_species = root
					root = {
						pop_percentage = {
							percentage > 0.4
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					is_same_species = root
					root = {
						pop_percentage = {
							percentage > 0.3
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					is_same_species = root
					root = {
						pop_percentage = {
							percentage > 0.2
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					is_same_species = root
					root = {
						pop_percentage = {
							percentage > 0.1
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					is_same_species = root
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					root = {
						pop_percentage = {
							percentage > 0.5
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					root = {
						pop_percentage = {
							percentage > 0.4
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					root = {
						pop_percentage = {
							percentage > 0.3
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					root = {
						pop_percentage = {
							percentage > 0.2
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				limit = {
					root = {
						pop_percentage = {
							percentage > 0.1
							limit = {
								is_exact_same_species = prev
							}
						}
					}
				}
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_population_species
				}
			}
			random_owned_pop_species = {
				save_event_target_as = human_fallen_empires_population_species
			}
		}
		change_dominant_species = {
			species = event_target:human_fallen_empires_population_species
			#change_all = no
		}
		# switch from hive
		if = {
			limit = {
				human_fallen_empires_trigger_is_hive = yes
				human_fallen_empires_trigger_non_sapient = no
			}
			create_country = {
				type = default
				species = this
				ignore_initial_colony_error = yes
			}
			copy_ethos_and_authority = last_created_country
			change_government = {
				civics = random
			}
		}
		human_fallen_empires_effect_fix_gov_hive = yes
		log = "changing main species for [this.GetName]"
	}
}

# on_modification_complete
country_event = {
	id = human_fallen_empires_population.51
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		country_event = {
			id = human_fallen_empires_population.50
		}
	}
}