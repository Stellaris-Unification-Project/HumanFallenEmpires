#
namespace = human_fallen_empires_features

# biobomb feature
planet_event = {
	id = human_fallen_empires_features.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		habitable_planet = yes
		exists = owner
		owner = {
			has_ascension_perk = human_fallen_empires_ap_biobomb
		}
		free_pop_tiles > 0
	}
	immediate = {
		create_species = {
			name = random
			class = random_non_machine
			portrait = random
			traits = random
			homeworld = root
		}
		if = {
			limit = {
				owner = {
					has_trait = trait_hive_mind
				}
			}
			modify_species = {
				species = last_created_species
				add_trait = trait_hive_mind
			}
			last_created_species = {
				set_citizenship_type = { country = root.owner type = citizenship_full cooldown = no }
			}
		}
		random_list = {
			90 = { }
			10 = {
				last_created_species = {
					human_fallen_empires_effect_add_random_trait = yes
				}
			}
		}
		create_pop = {
			species = last_created_species
		}
	}
}

# exodus feature, settle at planet
planet_event = {
	id = human_fallen_empires_features.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_features_exodus
		}
	}

	immediate = {
		owner = {
			set_country_type = default
			remove_modifier = human_fallen_empires_discovery_translator
			while = {
				limit = {
					check_variable = {
						which = human_fallen_empires_features_exodus_pop
						value > 0
					}
					root = {
						free_pop_tiles > 0
					}
				}
				change_variable = {
					which = human_fallen_empires_features_exodus_pop
					value = -1
				}
				root = {
					create_pop = {
						species = root.owner
					}
				}
			}
		}
		# need this to fix game's broken economy bug
		set_capital = yes
	}
}

# exodus civic feature 4-5
country_event = {
	id = human_fallen_empires_features.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_civic = human_fallen_empires_civic_features_exodus
	}

	immediate = {
		add_modifier = {
			modifier = human_fallen_empires_discovery_translator
			days = -1
		}
		set_country_type = human_fallen_empires_features_exodus
		add_influence = 100
		every_owned_pop = {
			prev = {
				change_variable = {
					which = human_fallen_empires_features_exodus_pop
					value = 1
				}
				add_energy = 50
				add_minerals = 50
			}
			kill_pop = yes
		}
		every_owned_planet = {
			create_fleet = {
				effect = {
					set_owner = root
					create_ship = {
						name = "New Hope"
						random_existing_design = colonizer
					}
					set_location = prev
					add_modifier = {
						modifier = human_fallen_empires_unkeep
						days = -1
					}
				}
			}
			destroy_colony = {
				keep_buildings = no
			}
			change_pc = pc_molten
		}
	}
}

planet_event = {
	id = human_fallen_empires_features.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = {
			has_civic = human_fallen_empires_civic_features_exodus
		}
	}

	immediate = {
		owner = {
			set_country_flag = custom_start_screen
			give_technology = {
				message = no
				tech = tech_human_fallen_empires_features_exodus
			}
		}
	}
}

# disband federation
country_event = {
	id = human_fallen_empires_features.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_federation = yes
	}

	immediate = {
		if = {
			limit = {
				is_at_war = yes
			}
			country_event = {
				id = human_fallen_empires_features.6
				days = 365
			}
			else = {
				leave_alliance = yes
			}
		}
	}
}

# agresiv diplomacy civic
# by ship on_ship_destroyed_perp
country_event = {
	id = human_fallen_empires_features.7
	hide_window = yes
    is_triggered_only = yes

	trigger = {
		has_valid_civic = human_fallen_empires_civic_features_aggressive_diplomacy
	}

	immediate = {
		add_monthly_resource_mult = {
			resource = unity
			value = 0.5
			min = 1
			max = 10
		}
	}
}

# by planet annexed
planet_event = {
	id = human_fallen_empires_features.8
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = {
			has_valid_civic = human_fallen_empires_civic_features_aggressive_diplomacy
		}
	}

	immediate = {
		owner = {
			add_monthly_resource_mult = {
				resource = unity
				value = 2
				min = 10
				max = 1000
			}
		}
	}
}

# by war entering
country_event = {
	id = human_fallen_empires_features.9
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_valid_civic = human_fallen_empires_civic_features_aggressive_diplomacy
	}

	immediate = {
		add_monthly_resource_mult = {
			resource = unity
			value = 2
			min = 100
			max = 10000
		}
	}
}
