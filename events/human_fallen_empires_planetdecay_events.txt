#
namespace = human_fallen_empires_planetdecay

# set events
planet_event = {
	id = human_fallen_empires_planetdecay.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		colony_age > 3600
		exists = owner
		not = {
			has_global_flag = human_fallen_empires_disable_planet_decay
		}
	}

	immediate = {
		planet_event = {
			id = human_fallen_empires_planetdecay.1
			days = 1
			random = 150
		}
		planet_event = {
			id = human_fallen_empires_planetdecay.3
			days = 20
			random = 250
		}
	}
}

# clean resource
planet_event = {
	id = human_fallen_empires_planetdecay.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_tile = {
			has_resource = yes
		}
	}

	immediate = {
		random_tile = {
			limit = {
				has_any_resource = yes
			}
			clear_resources = yes
		}
		planet_event = {
			id = human_fallen_empires_planetdecay.2
			days = 1
			random = 15
		}
	}
}

# inform
planet_event = {
	id = human_fallen_empires_planetdecay.2
	title = human_fallen_empires_planetdecay.2.name
	desc = human_fallen_empires_planetdecay.2.desc
	picture = GFX_evt_human_fallen_empires_city
	show_sound = event_construction
	location = root
    is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		not = {
			has_planet_flag = human_fallen_empires_planet_decay_start
		}
	}

	immediate = {
		set_planet_flag = human_fallen_empires_planet_decay_start
	}

	option = {
		name = human_fallen_empires_planetdecay.2.0
	}
}

# degradate pop
planet_event = {
	id = human_fallen_empires_planetdecay.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		or = {
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_gaia
			is_planet_class = pc_habitat
		}
		any_owned_pop = {
			exists = owner
			is_being_purged = no
			not = {
				pop_has_trait = trait_mechanical
			}
			root = {
				is_ideal_planet_class = {
					who = prev
					status = no
				}
			}
		}
	}

	immediate = {
		random_owned_pop =  {
			limit = {
				exists = owner
				is_being_purged = no
				not = {
					pop_has_trait = trait_mechanical
				}
				root = {
					is_ideal_planet_class = {
						who = prev
						status = no
					}
				}
			}
			modify_species = {
				species = this
				ideal_planet_class = root
			}
		}
		planet_event = {
			id = human_fallen_empires_planetdecay.2
			days = 1
			random = 30
		}
	}
}

# inform
planet_event = {
	id = human_fallen_empires_planetdecay.4
	title = human_fallen_empires_planetdecay.4.name
	desc = human_fallen_empires_planetdecay.4.desc
	picture = GFX_evt_genetic_modification
	show_sound = event_construction
	location = root
    is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		not = {
			has_planet_flag = human_fallen_empires_planetdecay.4_block
		}
	}

	immediate = {
		set_planet_flag = human_fallen_empires_planetdecay.4_block
	}

	option = {
		name = WORRYING
	}
}

# mine is depleted
planet_event = {
	id = human_fallen_empires_planetdecay.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_owner = no
		exists = controller
		orbital_deposit_tile = {
			has_resource = yes
		}
	}

	immediate = {
		if = {
			limit = {
				nor = {
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_0
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_1
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_2
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_3
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_4
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_5
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_6
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_7
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_8
					has_planet_flag = human_fallen_empires_planetdecay.6_stage_9
				}
			}
			set_planet_flag = human_fallen_empires_planetdecay.6_stage_0
			else = {
				if = {
					limit = {
						has_planet_flag = human_fallen_empires_planetdecay.6_stage_0
					}
					human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
					set_planet_flag = human_fallen_empires_planetdecay.6_stage_1
					else = {
						if = {
							limit = {
								has_planet_flag = human_fallen_empires_planetdecay.6_stage_1
							}
							human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
							set_planet_flag = human_fallen_empires_planetdecay.6_stage_2
							else = {
								if = {
									limit = {
										has_planet_flag = human_fallen_empires_planetdecay.6_stage_2
									}
									human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
									set_planet_flag = human_fallen_empires_planetdecay.6_stage_3
									else = {
										if = {
											limit = {
												has_planet_flag = human_fallen_empires_planetdecay.6_stage_3
											}
											human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
											set_planet_flag = human_fallen_empires_planetdecay.6_stage_4
											else = {
												if = {
													limit = {
														has_planet_flag = human_fallen_empires_planetdecay.6_stage_4
													}
													human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
													set_planet_flag = human_fallen_empires_planetdecay.6_stage_5
													else = {
														if = {
															limit = {
																has_planet_flag = human_fallen_empires_planetdecay.6_stage_5
															}
															human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
															set_planet_flag = human_fallen_empires_planetdecay.6_stage_6
															else = {
																if = {
																	limit = {
																		has_planet_flag = human_fallen_empires_planetdecay.6_stage_6
																	}
																	human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
																	set_planet_flag = human_fallen_empires_planetdecay.6_stage_7
																	else = {
																		if = {
																			limit = {
																				has_planet_flag = human_fallen_empires_planetdecay.6_stage_7
																			}
																			human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
																			set_planet_flag = human_fallen_empires_planetdecay.6_stage_8
																			else = {
																				if = {
																					limit = {
																						has_planet_flag = human_fallen_empires_planetdecay.6_stage_8
																					}
																					human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
																					set_planet_flag = human_fallen_empires_planetdecay.6_stage_9
																					else = {
																						if = {
																							limit = {
																								has_planet_flag = human_fallen_empires_planetdecay.6_stage_9
																							}
																							human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
																							set_planet_flag = human_fallen_empires_planetdecay.6_stage_10
																							else = {
																								human_fallen_empires_effect_planetdecay_clear_mine_flag = yes
																								controller = {
																									country_event = {
																										id = human_fallen_empires_planetdecay.6
																										days = 1
																										random = 15
																									}
																								}
																								orbital_deposit_tile = {
																									clear_resources = yes
																								}
																							}
																						}
																					}
																				}
																			}
																		}
																	}
																}
															}
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

# inform
country_event = {
	id = human_fallen_empires_planetdecay.6
	title = human_fallen_empires_planetdecay.6.name
	desc = human_fallen_empires_planetdecay.6.desc
	picture = GFX_evt_genetic_modification
	show_sound = event_construction
	location = from
	is_triggered_only = yes

	trigger = {
		not = {
			has_country_flag = human_fallen_empires_planetdecay.6_block
		}
	}

	option = {
		name = WORRYING
	}

	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_planetdecay.6_block
		}
	}
}
