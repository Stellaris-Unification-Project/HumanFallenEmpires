#
namespace = human_fallen_empires_init

# triggered from on game start 0
event = {
	id = human_fallen_empires_init.0
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
}

# menu
country_event = {
	id = human_fallen_empires_init.50
	title = human_fallen_empires_init.50.name
	desc = human_fallen_empires_init.50.desc
	picture = GFX_evt_human_fallen_empires_fallen_3
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_installed
		}
	}

	# disable story
	option = {
		name = human_fallen_empires_init.50.0.defined_text
		custom_tooltip = human_fallen_empires_init.50.0.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					human_fallen_empires_trigger_story_enabled = no
				}
				remove_global_flag = human_fallen_empires_story_disable
			}
			else = {
				set_global_flag = human_fallen_empires_story_disable
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# fast start
	option = {
		name = human_fallen_empires_init.50.1.0.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.0.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					human_fallen_empires_trigger_fast_start_enabled = yes
				}
				remove_global_flag = human_fallen_empires_init_fast_start
			}
			else = {
				set_global_flag = human_fallen_empires_init_fast_start
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# switch tech tier
	option = {
		name = human_fallen_empires_init.50.1.1.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.1.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
		}
		hidden_effect = {
			switch = {
				trigger = has_global_flag
				human_fallen_empires_init_tech_t4 = {
					remove_global_flag = human_fallen_empires_init_tech_t4
				}
				human_fallen_empires_init_tech_t3 = {
					remove_global_flag = human_fallen_empires_init_tech_t3
					set_global_flag = human_fallen_empires_init_tech_t4
				}
				human_fallen_empires_init_tech_t2 = {
					remove_global_flag = human_fallen_empires_init_tech_t2
					set_global_flag = human_fallen_empires_init_tech_t3
				}
				human_fallen_empires_init_tech_t1 = {
					remove_global_flag = human_fallen_empires_init_tech_t1
					set_global_flag = human_fallen_empires_init_tech_t2
				}
				default = {
					set_global_flag = human_fallen_empires_init_tech_t1
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# switch colony number
	option = {
		name = human_fallen_empires_init.50.1.2.0
		custom_tooltip = human_fallen_empires_init.50.1.2.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
			check_variable = {
				which = human_fallen_empires_init_fast_start_colony_num
				value = 0
			}
		}
		hidden_effect = {
			change_variable = {
				which = human_fallen_empires_init_fast_start_colony_num
				value = 5
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	option = {
		name = human_fallen_empires_init.50.1.2.1
		custom_tooltip = human_fallen_empires_init.50.1.2.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
			check_variable = {
				which = human_fallen_empires_init_fast_start_colony_num
				value > 0
			}
		}
		hidden_effect = {
			if = {
				limit = {
					check_variable = {
						which = human_fallen_empires_init_fast_start_colony_num
						value > 20
					}
				}
				set_variable = {
					which = human_fallen_empires_init_fast_start_colony_num
					value = 0
				}
			}
			else = {
				change_variable = {
					which = human_fallen_empires_init_fast_start_colony_num
					value = 5
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# fleet number
	option = {
		name = human_fallen_empires_init.50.1.3.0
		custom_tooltip = human_fallen_empires_init.50.1.3.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
			check_variable = {
				which = human_fallen_empires_init_fast_start_fleet_num
				value = 0
			}
		}
		hidden_effect = {
			change_variable = {
				which = human_fallen_empires_init_fast_start_fleet_num
				value = 1
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	option = {
		name = human_fallen_empires_init.50.1.3.1
		custom_tooltip = human_fallen_empires_init.50.1.3.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
			check_variable = {
				which = human_fallen_empires_init_fast_start_fleet_num
				value > 0
			}
		}
		hidden_effect = {
			if = {
				limit = {
					check_variable = {
						which = human_fallen_empires_init_fast_start_fleet_num
						value > 4
					}
				}
				set_variable = {
					which = human_fallen_empires_init_fast_start_fleet_num
					value = 0
				}
			}
			else = {
				change_variable = {
					which = human_fallen_empires_init_fast_start_fleet_num
					value = 1
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# pirate number
	option = {
		name = human_fallen_empires_init.50.1.4.0
		custom_tooltip = human_fallen_empires_init.50.1.4.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
			check_variable = {
				which = human_fallen_empires_init_fast_start_pirate_num
				value = 0
			}
		}
		hidden_effect = {
			change_variable = {
				which = human_fallen_empires_init_fast_start_pirate_num
				value = 5
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	option = {
		name = human_fallen_empires_init.50.1.4.1
		custom_tooltip = human_fallen_empires_init.50.1.4.tooltip
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
			check_variable = {
				which = human_fallen_empires_init_fast_start_pirate_num
				value > 0
			}
		}
		hidden_effect = {
			if = {
				limit = {
					check_variable = {
						which = human_fallen_empires_init_fast_start_pirate_num
						value > 25
					}
				}
				set_variable = {
					which = human_fallen_empires_init_fast_start_pirate_num
					value = 0
				}
			}
			else = {
				change_variable = {
					which = human_fallen_empires_init_fast_start_pirate_num
					value = 5
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# mining
	option = {
		name = human_fallen_empires_init.50.1.5.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.5.tooltip.defined_text
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
		}
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = human_fallen_empires_init_mining
				}
				remove_global_flag = human_fallen_empires_init_mining
			}
			else = {
				set_global_flag = human_fallen_empires_init_mining
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# comms
	option = {
		name = human_fallen_empires_init.50.1.6.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.6.tooltip.defined_text
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
		}
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = human_fallen_empires_init_comms
				}
				remove_global_flag = human_fallen_empires_init_comms
			}
			else = {
				set_global_flag = human_fallen_empires_init_comms
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# survey
	option = {
		name = human_fallen_empires_init.50.1.7.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.7.tooltip.defined_text
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
		}
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = human_fallen_empires_init_survey
				}
				remove_global_flag = human_fallen_empires_init_survey
			}
			else = {
				set_global_flag = human_fallen_empires_init_survey
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# develop
	option = {
		name = human_fallen_empires_init.50.1.8.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.8.tooltip.defined_text
		trigger = {
			human_fallen_empires_trigger_fast_start_enabled = yes
		}
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = human_fallen_empires_init_develop
				}
				remove_global_flag = human_fallen_empires_init_develop
			}
			else = {
				set_global_flag = human_fallen_empires_init_develop
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# start game
	option = {
		name = human_fallen_empires_init_begin
		hidden_effect = {
			country_event = {
				id = human_fallen_empires_init.100
			}
		}
	}
	option = {
		name = human_fallen_empires_init_begin_and_menu
		hidden_effect = {
			country_event = {
				id = human_fallen_empires_init.100
			}
			country_event = {
				id = human_fallen_empires_menu.1
			}
		}
	}
}

# main installation event
country_event = {
	id = human_fallen_empires_init.100
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_installed
		}
	}

	immediate = {
		every_country = {
			# prevent spawn vanilla pirate
			set_country_flag = birth_of_piracy
			set_country_flag = had_pirates_spawn
		}
		# prevent vanilla awake
		set_global_flag = sleepers_awake_happened
		# fast start installing
		country_event = {
			id = human_fallen_empires_init.101
		}
		# story mod installing
		country_event = {
			id = human_fallen_empires_init.102
		}
		set_global_flag = human_fallen_empires_installed
	}
	after = {
		remove_global_flag = human_fallen_empires_init_fast_start
	}
}

# fast start installation event
country_event = {
	id = human_fallen_empires_init.101
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		human_fallen_empires_trigger_fast_start_enabled = yes
	}

	immediate = {
		# init options
		# more colony
		while = {
			count = human_fallen_empires_init_fast_start_colony_num
			every_playable_country = {
				limit = {
					num_pops > 0
				}
				save_event_target_as = human_fallen_empires_init_target
				human_fallen_empires_effect_init_make_colony = yes
			}
		}
		# tech and res
		every_playable_country = {
			switch = {
				trigger = has_global_flag
				human_fallen_empires_init_tech_t4 = {
					human_fallen_empires_effect_init_give_tech_t4 = yes
					add_energy = 10000
					add_minerals = 10000
					add_influence = 500
					every_owned_pop = {
						owner = {
							add_unity = 250
						}
					}
				}
				human_fallen_empires_init_tech_t3 = {
					human_fallen_empires_effect_init_give_tech_t3 = yes
					add_energy = 8000
					add_minerals = 8000
					add_influence = 400
					every_owned_pop = {
						owner = {
							add_unity = 200
						}
					}
				}
				human_fallen_empires_init_tech_t2 = {
					human_fallen_empires_effect_init_give_tech_t2 = yes
					add_energy = 6000
					add_minerals = 6000
					add_influence = 300
					every_owned_pop = {
						owner = {
							add_unity = 150
						}
					}
				}
				human_fallen_empires_init_tech_t1 = {
					human_fallen_empires_effect_init_give_tech_t1 = yes
					add_energy = 4000
					add_minerals = 4000
					add_influence = 200
					every_owned_pop = {
						owner = {
							add_unity = 100
						}
					}
				}
			}
		}
		# more fleets
		while = {
			count = human_fallen_empires_init_fast_start_fleet_num
			every_playable_country = {
				human_fallen_empires_effect_init_make_fleet = yes
			}
		}
		# more pirate
		while = {
			count = human_fallen_empires_init_fast_start_pirate_num
			random_country = {
				limit = {
					is_country_type = default
				}
				save_event_target_as = human_fallen_empires_pirate_target
				human_fallen_empires_effect_pirate_init = yes
			}
		}
		# mining
		if = {
			limit = {
				has_global_flag = human_fallen_empires_init_mining
			}
			every_playable_country = {
				country_event = {
					id = human_fallen_empires_init.103
					days = 2
				}
			}
		}
		# comms
		if = {
			limit = {
				has_global_flag = human_fallen_empires_init_comms
			}
			every_playable_country = {
				set_global_flag = first_contact_event
				every_playable_country = {
					limit = {
						not = {
							has_communications = prev
						}
					}
					establish_communications_no_message = prev
				}
			}
		}
		# survey
		if = {
			limit = {
				has_global_flag = human_fallen_empires_init_survey
			}
			every_playable_country = {
				limit = {
					not = {
						has_technology = tech_automated_exploration
					}
				}
				give_technology = {
					tech = tech_automated_exploration
					message = no
				}
			}
		}
		# develop
		if = {
			limit = {
				has_global_flag = human_fallen_empires_init_develop
			}
			every_playable_country = {
				every_owned_planet = {
					planet_event = {
						id = human_fallen_empires_init.106
					}
				}
			}
		}
	}
	after = {
		# clean
		remove_global_flag = human_fallen_empires_init_tech_t4
		remove_global_flag = human_fallen_empires_init_tech_t3
		remove_global_flag = human_fallen_empires_init_tech_t2
		remove_global_flag = human_fallen_empires_init_tech_t1
		remove_global_flag = human_fallen_empires_init_mining
		remove_global_flag = human_fallen_empires_init_comms
		remove_global_flag = human_fallen_empires_init_survey
		remove_global_flag = human_fallen_empires_init_develop
		set_variable = {
			which = human_fallen_empires_init_fast_start_pirate_num
			value = 0
		}
		set_variable = {
			which = human_fallen_empires_init_fast_start_fleet_num
			value = 0
		}
		set_variable = {
			which = human_fallen_empires_init_fast_start_colony_num
			value = 0
		}
	}
}

# story mod installation event
country_event = {
	id = human_fallen_empires_init.102
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		human_fallen_empires_trigger_story_enabled = yes
	}

	immediate = {
		# find humans
		if = {
			limit = {
				any_country = {
					or = {
						has_country_flag = human_1
						has_country_flag = human_2
						species_portrait = human
					}
				}
			}
			every_country = {
				limit = {
					or = {
						has_country_flag = human_1
						has_country_flag = human_2
						species_portrait = human
					}
				}
				set_country_flag = human_fallen_empires_marked_as_human
			}
			if = {
				limit = {
					any_country = {
						has_country_flag = human_fallen_empires_marked_as_human
						is_ai = no
					}
				}
				random_country = {
					limit = {
						has_country_flag = human_fallen_empires_marked_as_human
						is_ai = no
					}
					species = {
						save_event_target_as = human_fallen_empires_human_species
					}
				}
			}
			else = {
				random_country = {
					limit = {
						has_country_flag = human_fallen_empires_marked_as_human
					}
					species = {
						save_event_target_as = human_fallen_empires_human_species
					}
				}
			}
		}
		random_system = {
			limit = {
				has_star_flag = sol
			}
			random_system_planet = {
				limit = {
					or = {
						has_planet_flag = planet_earth
						has_planet_flag = nuked_earth
						and = {
							exists = owner
							is_capital = yes
						}
					}
				}
				log = "hfe find earth"
				save_global_event_target_as = human_fallen_empires_earth
			}
		}
		# create need species
		# egypt
		create_species = {
			name = "Ju Ahet"
			plural = "Ju Ahet"
			class = HUM
			portrait = human_fallen_empires_egypt_portrait
			traits = {
				ideal_planet_class = pc_continental
				trait = trait_extremely_adaptive
				trait = trait_venerable
				trait = trait_slow_breeders
				trait = trait_psionic
			}
			immortal = yes
			effect = {
				if = {
					limit = {
						exists = event_target:human_fallen_empires_earth
					}
					set_species_homeworld = event_target:human_fallen_empires_earth
				}
				if = {
					limit = {
						exists = event_target:human_fallen_empires_human_species
					}
					set_species_identity = event_target:human_fallen_empires_human_species
				}
				save_global_event_target_as = human_fallen_empires_egypt_species
			}
		}
		# ahet
		create_species = {
			name = Ahet
			plural = Ahet
			class = REP
			portrait = random
			traits = {
				ideal_planet_class = pc_tropical
				trait = trait_slow_breeders
				trait = trait_strong
				trait = random_traits
			}
			effect = {
				save_global_event_target_as = human_fallen_empires_ahet_species
			}
		}
		# varelse
		create_species = {
			name = Varelse
			plural = Varelse
			class = REP
			portrait = random
			traits = {
				ideal_planet_class = pc_desert
				trait = trait_industrious
				trait = trait_natural_engineers
				trait = trait_strong
				trait = trait_repugnant
			}
			effect = {
				save_global_event_target_as = human_fallen_empires_varelse_species
			}
		}
		# future
		create_species = {
			name = Human
			plural = Humans
			class = HUM
			portrait = human
			traits = {
				ideal_planet_class = pc_continental
				trait = trait_intelligent
				trait = trait_thrifty
				trait = trait_strong
				trait = trait_solitary
			}
			effect = {
				if = {
					limit = {
						exists = event_target:human_fallen_empires_earth
					}
					set_species_homeworld = event_target:human_fallen_empires_earth
				}
				set_species_identity = event_target:human_fallen_empires_egypt_species
				save_global_event_target_as = human_fallen_empires_future_species
			}
		}
		# spawn story systems
		set_spawn_system_batch = begin
		# future
		random_rim_system = {
			limit = {
				not = { exists = owner }
				human_fallen_empires_trigger_system_in_free_space = yes
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_future
			}
			set_global_flag = human_fallen_empires_future_spawned
		}
		# egypt
		random_system = {
			limit = {
				not = { exists = owner }
				human_fallen_empires_trigger_system_in_free_space = yes
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_egypt
			}
			set_global_flag = human_fallen_empires_egypt_spawned
			random_neighbor_system = {
				spawn_system = {
					min_distance = 10
					max_distance = 20
					hyperlane = no
					initializer = human_fallen_empires_hope
				}
				random_neighbor_system = {
					limit = {
						nor = {
							is_same_value = prevprev
							is_same_value = prev
						}
					}
					spawn_system = {
						min_distance = 10
						max_distance = 20
						hyperlane = no
						initializer = human_fallen_empires_gift
					}
				}
			}
		}
		# some other systems
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_memorial_01
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_memorial_02
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_memorial_03
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_memorial_04
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_varelse
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_ahet
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_ahet_2
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_ahet_home
			}
		}
		random_system = {
			limit = {
				not = { exists = owner }
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_copernicus
			}
		}
		# drone
		random_system = {
			limit = {
				not = { exists = owner }
				human_fallen_empires_trigger_system_in_free_space = yes
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_drone_sector_0
			}
		}
		random_system = {
			limit = {
				has_star_flag = human_fallen_empires_drone_0
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_drone_sector_1
			}
		}
		random_system = {
			limit = {
				has_star_flag = human_fallen_empires_drone_1
			}
			spawn_system = {
				min_distance = 10
				max_distance = 20
				hyperlane = no
				initializer = human_fallen_empires_drone_sector_10
			}
		}
		set_spawn_system_batch = end
		# expand borders and develop
		event_target:human_fallen_empires_egypt_country = {
			country_event = {
				id = human_fallen_empires_init.103
				days = 2
			}
			# country_event = {
			# id = human_fallen_empires_init.103
			# days = 3
			# }
		}
		event_target:human_fallen_empires_future_country = {
			country_event = {
				id = human_fallen_empires_init.103
				days = 2
			}
			country_event = {
				id = human_fallen_empires_init.103
				days = 3
			}
		}
		event_target:human_fallen_empires_drone_country = {
			country_event = {
				id = human_fallen_empires_init.103
				days = 2
			}
			# country_event = {
			# 	id = human_fallen_empires_init.103
			# 	days = 3
			# }
		}
	}
}

country_event = {
	id = human_fallen_empires_init.103
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		human_fallen_empires_effect_init_expand_borders = yes
		country_event = {
			id = human_fallen_empires_init.104
			days = 2
		}
	}
}

country_event = {
	id = human_fallen_empires_init.104
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		human_fallen_empires_effect_init_set_minings_stations = yes
	}
}

planet_event = {
	id = human_fallen_empires_init.106
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		exists = owner
	}

	immediate = {
		human_fallen_empires_effect_init_develop_planet = yes
	}
}
