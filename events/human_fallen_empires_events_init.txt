#
namespace = human_fallen_empires_init

# triggered from on game start 0
event = {
	id = human_fallen_empires_init.0
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		random_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
}

# triggered from game loaded 1
country_event = {
	id = human_fallen_empires_init.1
	hide_window = yes
	fire_only_once = yes

	trigger = {
		years_passed > 0
	}

	immediate = {
		random_country = {
			country_event = {
				id = human_fallen_empires_init.100
			}
		}
	}
}

# menu
country_event = {
	id = human_fallen_empires_init.50
	title = human_fallen_empires_init.50.name
	desc = human_fallen_empires_init.50.desc
	picture = GFX_evt_human_fallen_empires_fallen_3
	is_triggered_only = yes

	# disable story
	option = {
		name = human_fallen_empires_init.50.0.defined_text
		custom_tooltip = human_fallen_empires_init.50.0.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = human_fallen_empires_disable_story
				}
				remove_global_flag = human_fallen_empires_disable_story
				else = {
					set_global_flag = human_fallen_empires_disable_story
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# fast start
	option = {
		name = human_fallen_empires_init.50.1.0.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.0.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					has_global_flag = human_fallen_empires_init_fast_start
				}
				remove_global_flag = human_fallen_empires_init_fast_start
				else = {
					set_global_flag = human_fallen_empires_init_fast_start
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# switch tech tier
	option = {
		name = human_fallen_empires_init.50.1.1.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.1.tooltip
		trigger = {
			has_global_flag = human_fallen_empires_init_fast_start
		}
		hidden_effect = {
			if = {
				limit = {
					nor = {
						has_global_flag = human_fallen_empires_init_tech_t4
						has_global_flag = human_fallen_empires_init_tech_t3
						has_global_flag = human_fallen_empires_init_tech_t2
						has_global_flag = human_fallen_empires_init_tech_t1
					}
				}
				set_global_flag = human_fallen_empires_init_tech_t1
				else = {
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_tech_t4 = {
							add_minerals = 20
							remove_global_flag = human_fallen_empires_init_tech_t4
						}
						human_fallen_empires_init_tech_t3 = {
							add_minerals = 20
							remove_global_flag = human_fallen_empires_init_tech_t3
							set_global_flag = human_fallen_empires_init_tech_t4
						}
						human_fallen_empires_init_tech_t2 = {
							add_minerals = 20
							remove_global_flag = human_fallen_empires_init_tech_t2
							set_global_flag = human_fallen_empires_init_tech_t3
						}
						human_fallen_empires_init_tech_t1 = {
							add_minerals = 20
							remove_global_flag = human_fallen_empires_init_tech_t1
							set_global_flag = human_fallen_empires_init_tech_t2
						}
						# не пашет. а жаль
						#default = {
						#	add_minerals = 10
						#	set_global_flag = human_fallen_empires_init_tech_t1
						#}
					}
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# switch colony num
	option = {
		name = human_fallen_empires_init.50.1.2.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.2.tooltip
		trigger = {
			has_global_flag = human_fallen_empires_init_fast_start
		}
		hidden_effect = {
			if = {
				limit = {
					nor = {
						has_global_flag = human_fallen_empires_init_colony_25
						has_global_flag = human_fallen_empires_init_colony_20
						has_global_flag = human_fallen_empires_init_colony_15
						has_global_flag = human_fallen_empires_init_colony_10
						has_global_flag = human_fallen_empires_init_colony_5
					}
				}
				set_global_flag = human_fallen_empires_init_colony_5
				else = {
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_colony_25 = {
							remove_global_flag = human_fallen_empires_init_colony_25
						}
						human_fallen_empires_init_colony_20 = {
							remove_global_flag = human_fallen_empires_init_colony_20
							set_global_flag = human_fallen_empires_init_colony_25
						}
						human_fallen_empires_init_colony_15 = {
							remove_global_flag = human_fallen_empires_init_colony_15
							set_global_flag = human_fallen_empires_init_colony_20
						}
						human_fallen_empires_init_colony_10 = {
							remove_global_flag = human_fallen_empires_init_colony_10
							set_global_flag = human_fallen_empires_init_colony_15
						}
						human_fallen_empires_init_colony_5 = {
							remove_global_flag = human_fallen_empires_init_colony_5
							set_global_flag = human_fallen_empires_init_colony_10
						}
					}
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# fleet num
	option = {
		name = human_fallen_empires_init.50.1.3.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.3.tooltip
		trigger = {
			has_global_flag = human_fallen_empires_init_fast_start
		}
		hidden_effect = {
			if = {
				limit = {
					nor = {
						has_global_flag = human_fallen_empires_init_fleet_5
						has_global_flag = human_fallen_empires_init_fleet_4
						has_global_flag = human_fallen_empires_init_fleet_3
						has_global_flag = human_fallen_empires_init_fleet_2
						has_global_flag = human_fallen_empires_init_fleet_1
					}
				}
				set_global_flag = human_fallen_empires_init_fleet_1
				else = {
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_fleet_5 = {
							remove_global_flag = human_fallen_empires_init_fleet_5
						}
						human_fallen_empires_init_fleet_4 = {
							remove_global_flag = human_fallen_empires_init_fleet_4
							set_global_flag = human_fallen_empires_init_fleet_5
						}
						human_fallen_empires_init_fleet_3 = {
							remove_global_flag = human_fallen_empires_init_fleet_3
							set_global_flag = human_fallen_empires_init_fleet_4
						}
						human_fallen_empires_init_fleet_2 = {
							remove_global_flag = human_fallen_empires_init_fleet_2
							set_global_flag = human_fallen_empires_init_fleet_3
						}
						human_fallen_empires_init_fleet_1 = {
							remove_global_flag = human_fallen_empires_init_fleet_1
							set_global_flag = human_fallen_empires_init_fleet_2
						}
					}
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# pirate num
	option = {
		name = human_fallen_empires_init.50.1.4.defined_text
		custom_tooltip = human_fallen_empires_init.50.1.4.tooltip
		trigger = {
			has_global_flag = human_fallen_empires_init_fast_start
		}
		hidden_effect = {
			if = {
				limit = {
					nor = {
						has_global_flag = human_fallen_empires_init_pirate_25
						has_global_flag = human_fallen_empires_init_pirate_20
						has_global_flag = human_fallen_empires_init_pirate_15
						has_global_flag = human_fallen_empires_init_pirate_10
						has_global_flag = human_fallen_empires_init_pirate_5
					}
				}
				set_global_flag = human_fallen_empires_init_pirate_5
				else = {
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_pirate_25 = {
							remove_global_flag = human_fallen_empires_init_pirate_25
						}
						human_fallen_empires_init_pirate_20 = {
							remove_global_flag = human_fallen_empires_init_pirate_20
							set_global_flag = human_fallen_empires_init_pirate_25
						}
						human_fallen_empires_init_pirate_15 = {
							remove_global_flag = human_fallen_empires_init_pirate_15
							set_global_flag = human_fallen_empires_init_pirate_20
						}
						human_fallen_empires_init_pirate_10 = {
							remove_global_flag = human_fallen_empires_init_pirate_10
							set_global_flag = human_fallen_empires_init_pirate_15
						}
						human_fallen_empires_init_pirate_5 = {
							remove_global_flag = human_fallen_empires_init_pirate_5
							set_global_flag = human_fallen_empires_init_pirate_10
						}
					}
				}
			}
			country_event = {
				id = human_fallen_empires_init.50
			}
		}
	}
	# start game
	option = {
		name = human_fallen_empires_init_begin
		hidden_effect = {
			country_event = {
				id = human_fallen_empires_init.100
			}
		}
	}
	option = {
		name = human_fallen_empires_init_begin_and_menu
		hidden_effect = {
			country_event = {
				id = human_fallen_empires_init.100
			}
			country_event = {
				id = human_fallen_empires_menu.1
			}
		}
	}
}

# main installation event
country_event = {
	id = human_fallen_empires_init.100
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = {
			limit = {
				not = {
					has_global_flag = human_fallen_empires_installed
				}
			}
			every_country = {
				# prevent spawn vanilla pirate
				set_country_flag = birth_of_piracy
				set_country_flag = had_pirates_spawn
			}
			# prevent vanilla awake
			set_global_flag = sleepers_awake_happened
			# story mod, enabled by default
			if = {
				limit = {
					not = {
						has_global_flag = human_fallen_empires_disable_story
					}
				}
				# find humans
				if = {
					limit = {
						any_country = {
							or = {
								has_country_flag = human_1
								has_country_flag = human_2
								species_portrait = human
							}
						}
					}
					every_country = {
						limit = {
							or = {
								has_country_flag = human_1
								has_country_flag = human_2
								species_portrait = human
							}
						}
						set_country_flag = human_fallen_empires_marked_as_human
					}
					if = {
						limit = {
							any_country = {
								has_country_flag = human_fallen_empires_marked_as_human
								is_ai = no
							}
						}
						random_country = {
							limit = {
								has_country_flag = human_fallen_empires_marked_as_human
								is_ai = no
							}
							species = {
								save_event_target_as = human_fallen_empires_human_species
							}
						}
						else = {
							random_country = {
								limit = {
									has_country_flag = human_fallen_empires_marked_as_human
								}
								species = {
									save_event_target_as = human_fallen_empires_human_species
								}
							}
						}
					}
				}
				# create need species
				# egypt
				create_species = {
					name = "Ju Ahet"
					plural = "Ju Ahet"
					class = HUM
					portrait = human_fallen_empires_egypt_portrait
					traits = {
						ideal_planet_class = pc_continental
						trait = trait_extremely_adaptive
						trait = trait_venerable
						trait = trait_slow_breeders
						trait = trait_psionic
					}
					immortal = yes
				}
				last_created_species = {
					save_global_event_target_as = human_fallen_empires_egypt_species
					if = {
						limit = {
							exists = event_target:human_fallen_empires_human_species
						}
						set_species_identity = event_target:human_fallen_empires_human_species
					}
				}
				# ahet
				create_species = {
					name = Ahet
					plural = Ahet
					class = "REP"
					portrait = random
					traits = {
						ideal_planet_class = pc_tropical
						trait = trait_slow_breeders
						trait = trait_strong
						trait = random_traits
					}
				}
				last_created_species = {
					save_global_event_target_as = human_fallen_empires_ahet_species
				}
				# varelse
				create_species = {
					name = Varelse
					plural = Varelse
					class = "REP"
					portrait = random
					traits = {
						ideal_planet_class = pc_desert
						trait = trait_industrious
						trait = trait_natural_engineers
						trait = trait_strong
						trait = trait_repugnant
					}
				}
				last_created_species = {
					save_global_event_target_as = human_fallen_empires_varelse_species
				}
				# future
				create_species = {
					name = Human
					plural = Humans
					class = HUM
					portrait = human
					traits = {
						ideal_planet_class = pc_continental
						trait = trait_intelligent
						trait = trait_thrifty
						trait = trait_strong
						trait = trait_solitary
					}
				}
				last_created_species = {
					set_species_identity = event_target:human_fallen_empires_egypt_species
					save_global_event_target_as = human_fallen_empires_future_species
				}
				# future
				random_rim_system = {
					limit = {
						has_owner = no
						is_fe_cluster = no
						not = {
							any_system = {
								distance = {
									source = prev
									max_distance = 50
									min_distance = 0
								}
								has_owner = yes
							}
						}
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_future
					}
					set_global_flag = human_fallen_empires_future_spawned
				}
				# egypt
				random_system = {
					limit = {
						has_owner = no
						is_fe_cluster = no
						not = {
							any_system = {
								distance = {
									source = prev
									max_distance = 50
									min_distance = 0
								}
								has_owner = yes
							}
						}
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_egypt
					}
					set_global_flag = human_fallen_empires_egypt_spawned
				}
				random_system = {
					limit = {
						has_star_flag = human_fallen_empires_egypt_0
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_hope
					}
				}
				random_system = {
					limit = {
						has_star_flag = human_fallen_empires_egypt_1
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_gift
					}
				}
				#some other systems
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_memorial_01
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_memorial_02
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_memorial_03
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_memorial_04
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_varelse
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_ahet
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_ahet_2
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_ahet_home
					}
				}
				random_system = {
					limit = {
						has_owner = no
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_copernicus
					}
				}
				# drone
				random_system = {
					limit = {
						has_owner = no
						is_fe_cluster = no
						not = {
							any_system = {
								distance = {
									source = prev
									max_distance = 50
									min_distance = 0
								}
								has_owner = yes
							}
						}
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_drone_sector_0
					}
				}
				random_system = {
					limit = {
						has_star_flag = human_fallen_empires_drone_0
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_drone_sector_1
					}
				}
				random_system = {
					limit = {
						has_star_flag = human_fallen_empires_drone_1
					}
					spawn_system = {
						min_distance = 0
						max_distance = 10
						hyperlane = yes
						initializer = human_fallen_empires_drone_sector_10
					}
				}
				# expand borders and develop
				country_event = {
					id = human_fallen_empires_init.101
					days = 3
				}
				country_event = {
					id = human_fallen_empires_init.101
					days = 5
				}
			}
			# fast start
			if = {
				limit = {
					has_global_flag = human_fallen_empires_init_fast_start
				}
				# init options
				# more tech and res
				every_country = {
					limit = {
						is_country_type = default
					}
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_tech_t4 = {
							human_fallen_empires_effect_init_give_tech_t4 = yes
						}
						human_fallen_empires_init_tech_t3 = {
							human_fallen_empires_effect_init_give_tech_t3 = yes
						}
						human_fallen_empires_init_tech_t2 = {
							human_fallen_empires_effect_init_give_tech_t2 = yes
						}
						human_fallen_empires_init_tech_t1 = {
							human_fallen_empires_effect_init_give_tech_t1 = yes
						}
					}
				}
				# all communications
				every_country = {
					limit = {
						is_country_type = default
					}
					every_country = {
						limit = {
							is_country_type = default
							not = {
								has_communications = prev
							}
						}
						establish_communications_no_message = prev
					}
				}
				# more colony
				switch = {
					trigger = has_global_flag
					human_fallen_empires_init_colony_25 = {
						human_fallen_empires_effect_init_make_25_colony = yes
					}
					human_fallen_empires_init_colony_20 = {
						human_fallen_empires_effect_init_make_20_colony = yes
					}
					human_fallen_empires_init_colony_15 = {
						human_fallen_empires_effect_init_make_15_colony = yes
					}
					human_fallen_empires_init_colony_10 = {
						human_fallen_empires_effect_init_make_10_colony = yes
					}
					human_fallen_empires_init_colony_5 = {
						human_fallen_empires_effect_init_make_5_colony = yes
					}
				}
				# develop some
				every_country = {
					limit = {
						is_country_type = default
					}
					save_event_target_as = human_fallen_empires_init_target
					capital_scope = {
						human_fallen_empires_effect_init_develop_capital = yes
					}
					human_fallen_empires_effect_init_expand_borders = yes
					human_fallen_empires_effect_init_set_minings_stations = yes
					# more fleets
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_fleet_5 = {
							while = {
								count = 5
								human_fallen_empires_effect_init_make_fleet = yes
							}
						}
						human_fallen_empires_init_fleet_4 = {
							while = {
								count = 4
								human_fallen_empires_effect_init_make_fleet = yes
							}
						}
						human_fallen_empires_init_fleet_3 = {
							while = {
								count = 3
								human_fallen_empires_effect_init_make_fleet = yes
							}
						}
						human_fallen_empires_init_fleet_2 = {
							while = {
								count = 2
								human_fallen_empires_effect_init_make_fleet = yes
							}
						}
						human_fallen_empires_init_fleet_1 = {
							human_fallen_empires_effect_init_make_fleet = yes
						}
					}
					# some res
					add_food = 200
					switch = {
						trigger = has_global_flag
						human_fallen_empires_init_tech_t4 = {
							add_energy = 10000
							add_minerals = 10000
							add_influence = 500
							every_owned_pop = {
								owner = {
									add_unity = 250
								}
							}
						}
						human_fallen_empires_init_tech_t3 = {
							add_energy = 8000
							add_minerals = 8000
							add_influence = 400
							every_owned_pop = {
								owner = {
									add_unity = 200
								}
							}
						}
						human_fallen_empires_init_tech_t2 = {
							add_energy = 6000
							add_minerals = 6000
							add_influence = 300
							every_owned_pop = {
								owner = {
									add_unity = 150
								}
							}
						}
						human_fallen_empires_init_tech_t1 = {
							add_energy = 4000
							add_minerals = 4000
							add_influence = 200
							every_owned_pop = {
								owner = {
									add_unity = 100
								}
							}
						}
					}
					run_ai_strategic_data = yes
				}
				# more pirate
				switch = {
					trigger = has_global_flag
					human_fallen_empires_init_pirate_25 = {
						while = {
							count = 25
							random_country = {
								limit = {
									is_country_type = default
								}
								save_event_target_as = human_fallen_empires_pirate_target
								human_fallen_empires_effect_pirate_init = yes
							}
						}
					}
					human_fallen_empires_init_pirate_20 = {
						while = {
							count = 20
							random_country = {
								limit = {
									is_country_type = default
								}
								save_event_target_as = human_fallen_empires_pirate_target
								human_fallen_empires_effect_pirate_init = yes
							}
						}
					}
					human_fallen_empires_init_pirate_15 = {
						while = {
							count = 15
							random_country = {
								limit = {
									is_country_type = default
								}
								save_event_target_as = human_fallen_empires_pirate_target
								human_fallen_empires_effect_pirate_init = yes
							}
						}
					}
					human_fallen_empires_init_pirate_10 = {
						while = {
							count = 10
							random_country = {
								limit = {
									is_country_type = default
								}
								save_event_target_as = human_fallen_empires_pirate_target
								human_fallen_empires_effect_pirate_init = yes
							}
						}
					}
					human_fallen_empires_init_pirate_5 = {
						while = {
							count = 5
							random_country = {
								limit = {
									is_country_type = default
								}
								save_event_target_as = human_fallen_empires_pirate_target
								human_fallen_empires_effect_pirate_init = yes
							}
						}
					}
				}
			}
		}
		set_global_flag = human_fallen_empires_installed
	}
}

country_event = {
	id = human_fallen_empires_init.101
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		event_target:human_fallen_empires_egypt_country = {
			human_fallen_empires_effect_init_expand_borders = yes
			human_fallen_empires_effect_init_set_minings_stations = yes
		}
		event_target:human_fallen_empires_future_country = {
			human_fallen_empires_effect_init_expand_borders = yes
			human_fallen_empires_effect_init_set_minings_stations = yes
		}
		event_target:human_fallen_empires_drone_country = {
			human_fallen_empires_effect_init_expand_borders = yes
			human_fallen_empires_effect_init_set_minings_stations = yes
		}
	}
}
