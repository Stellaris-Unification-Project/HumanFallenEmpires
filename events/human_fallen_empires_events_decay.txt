#
namespace = human_fallen_empires_decay

# set events
planet_event = {
	id = human_fallen_empires_decay.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		colony_age > 3600
		exists = owner
		not = {
			has_global_flag = human_fallen_empires_disable_planet_decay
		}
	}

	immediate = {
		planet_event = {
			id = human_fallen_empires_decay.1
			days = 1
			random = 150
		}
		planet_event = {
			id = human_fallen_empires_decay.3
			days = 20
			random = 250
		}
	}
}

# clean resource
planet_event = {
	id = human_fallen_empires_decay.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_deposit = yes
	}

	immediate = {
		random_deposit = {
			clear_deposits = yes
		}
		planet_event = {
			id = human_fallen_empires_decay.2
			days = 1
			random = 15
		}
	}
}

# inform
planet_event = {
	id = human_fallen_empires_decay.2
	title = human_fallen_empires_decay.2.name
	desc = human_fallen_empires_decay.2.desc
	picture = GFX_evt_human_fallen_empires_city
	show_sound = event_construction
	location = root
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		not = {
			has_planet_flag = human_fallen_empires_planet_decay_start
		}
	}

	immediate = {
		set_planet_flag = human_fallen_empires_planet_decay_start
	}

	option = {
		name = human_fallen_empires_decay.2.0
	}
}

# degradate pop
planet_event = {
	id = human_fallen_empires_decay.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		or = {
			is_planet_class = pc_ringworld_habitable
			is_planet_class = pc_gaia
			is_planet_class = pc_habitat
		}
		any_owned_pop = {
			exists = owner
			is_being_purged = no
			human_fallen_empires_trigger_is_robot = no
			root = {
				is_ideal_planet_class = {
					who = prev
					status = no
				}
			}
		}
	}

	immediate = {
		random_owned_pop =  {
			limit = {
				exists = owner
				is_being_purged = no
				human_fallen_empires_trigger_is_robot = no
				root = {
					is_ideal_planet_class = {
						who = prev
						status = no
					}
				}
			}
			modify_species = {
				ideal_planet_class = root
			}
		}
		planet_event = {
			id = human_fallen_empires_decay.2
			days = 1
			random = 30
		}
	}
}

# inform
planet_event = {
	id = human_fallen_empires_decay.4
	title = human_fallen_empires_decay.4.name
	desc = human_fallen_empires_decay.4.desc
	picture = GFX_evt_genetic_modification
	show_sound = event_construction
	location = root
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_ai = no
		}
		not = {
			has_planet_flag = human_fallen_empires_decay.4_block
		}
	}

	immediate = {
		set_planet_flag = human_fallen_empires_decay.4_block
	}

	option = {
		name = WORRYING
	}
}

# mine is depleted
planet_event = {
	id = human_fallen_empires_decay.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			exists = owner
		}
		exists = controller
		has_deposit = yes
	}

	immediate = {
		if = {
			limit = {
				nor = {
					has_planet_flag = human_fallen_empires_decay.6_stage_0
					has_planet_flag = human_fallen_empires_decay.6_stage_1
					has_planet_flag = human_fallen_empires_decay.6_stage_2
					has_planet_flag = human_fallen_empires_decay.6_stage_3
					has_planet_flag = human_fallen_empires_decay.6_stage_4
					has_planet_flag = human_fallen_empires_decay.6_stage_5
					has_planet_flag = human_fallen_empires_decay.6_stage_6
					has_planet_flag = human_fallen_empires_decay.6_stage_7
					has_planet_flag = human_fallen_empires_decay.6_stage_8
					has_planet_flag = human_fallen_empires_decay.6_stage_9
					has_planet_flag = human_fallen_empires_decay.6_stage_10
				}
			}
			set_planet_flag = human_fallen_empires_decay.6_stage_0
		}
		else = {
			switch = {
				trigger = has_planet_flag
				human_fallen_empires_decay.6_stage_0 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_0
					set_planet_flag = human_fallen_empires_decay.6_stage_1
				}
				human_fallen_empires_decay.6_stage_1 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_1
					set_planet_flag = human_fallen_empires_decay.6_stage_2
				}
				human_fallen_empires_decay.6_stage_2 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_2
					set_planet_flag = human_fallen_empires_decay.6_stage_3
				}
				human_fallen_empires_decay.6_stage_3 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_3
					set_planet_flag = human_fallen_empires_decay.6_stage_4
				}
				human_fallen_empires_decay.6_stage_4 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_4
					set_planet_flag = human_fallen_empires_decay.6_stage_5
				}
				human_fallen_empires_decay.6_stage_5 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_5
					set_planet_flag = human_fallen_empires_decay.6_stage_6
				}
				human_fallen_empires_decay.6_stage_6 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_6
					set_planet_flag = human_fallen_empires_decay.6_stage_7
				}
				human_fallen_empires_decay.6_stage_7 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_7
					set_planet_flag = human_fallen_empires_decay.6_stage_8
				}
				human_fallen_empires_decay.6_stage_8 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_8
					set_planet_flag = human_fallen_empires_decay.6_stage_9
				}
				human_fallen_empires_decay.6_stage_9 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_9
					set_planet_flag = human_fallen_empires_decay.6_stage_10
				}
				human_fallen_empires_decay.6_stage_10 = {
					remove_planet_flag = human_fallen_empires_decay.6_stage_10
					orbital_deposit_tile = {
						clear_deposits = yes
					}
					controller = {
						country_event = {
							id = human_fallen_empires_decay.6
							days = 1
							random = 15
						}
					}
				}
			}
		}
	}
}

# inform
country_event = {
	id = human_fallen_empires_decay.6
	title = human_fallen_empires_decay.6.name
	desc = human_fallen_empires_decay.6.desc
	picture = GFX_evt_human_fallen_empires_city
	show_sound = event_construction
	location = from
	is_triggered_only = yes

	trigger = {
		not = {
			has_country_flag = human_fallen_empires_decay.6_block
		}
	}

	option = {
		name = WORRYING
	}

	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_decay.6_block
		}
	}
}
