#
namespace = human_fallen_empires_maintenance

# This = Ship
# From = Disabler Ship
# kill starbases of pirate and drone on_ship_disabled
ship_event = {
	id = human_fallen_empires_maintenance.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = from.owner
		exists = owner
		owner = {
			or = {
				is_country_type = human_fallen_empires_drone
				is_country_type = human_fallen_empires_pirate
			}
		}
		is_ship_class = shipclass_starbase
	}

	immediate = {
		if = {
			limit = {
				owner = {
					is_country_type = human_fallen_empires_pirate
				}
				from.owner = {
					is_country_type = human_fallen_empires_pirate
				}
			}
			# order is matter
			owner = {
				# may be change this
				every_owned_planet = {
					limit = {
						solar_system = {
							is_same_value = root.solar_system
						}
					}
					set_owner = from.owner
				}
			}
			fleet = {
				set_owner = from.owner
			}
			else = {
				owner = {
					if = {
						limit = {
							is_country_type = human_fallen_empires_pirate
							num_starbases = 1
							any_country = {
								is_country_type = human_fallen_empires_pirate
							}
						}
						random_country = {
							limit = {
								is_country_type = human_fallen_empires_pirate
							}
							prev = {
								every_owned_fleet = {
									set_owner = prevprev
								}
							}
						}
					}
					every_owned_planet = {
						limit = {
							solar_system = {
								is_same_value = root.solar_system
							}
						}
						if = {
							limit = {
								num_pops > 0
							}
							every_owned_pop = {
								human_fallen_empires_effect_refugee_or_die = yes
								# мб стоит таки сделать преоритет для того, кто уничтожает базу
								# if = {
								# limit = {
								# not = {
								# has_citizenship_type = {
								# type = citizenship_purge
								# country = root
								# }
								# }
								# }
								# save_event_target_as = human_fallen_empires_settle_pop_target
								# root = {
								# human_fallen_empires_effect_settle_pop = yes
								# human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
								# }
								# else = {
								# }
								# }
							}
						}
						destroy_colony = yes
						change_pc = pc_asteroid
					}
				}
				fleet = {
					destroy_fleet = this
				}
			}
		}
	}
}
