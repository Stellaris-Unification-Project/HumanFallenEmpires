#
namespace = human_fallen_empires_plague

# start plague
country_event = {
	id = human_fallen_empires_plague.0
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		nor = {
			has_global_flag = human_fallen_empires_disable_plague
			has_global_flag = human_fallen_empires_plague_srarted
		}
		or = {
			years_passed > 120
			and = {
				years_passed > 110
				is_difficulty > 0
			}
			and = {
				years_passed > 100
				is_difficulty > 1
			}
			and = {
				years_passed > 90
				is_difficulty > 2
			}
		}
	}

	immediate = {
		random_list = {
			20 = {
				break = yes
			}
			10 = {
			}
		}
		set_global_flag = human_fallen_empires_plague_srarted
		every_playable_country = {
			begin_event_chain = {
				event_chain = human_fallen_empires_plague_count
				target = this
			}
		}
		if = {
			limit = {
				exists = event_target:human_fallen_empires_plague_count
			}
			event_target:human_fallen_empires_plague_count = {
				set_variable = {
					which = human_fallen_empires_plague_planet_num
					value = 0
				}
			}
			else = {
				random_planet = {
					save_global_event_target_as = human_fallen_empires_plague_count
				}
			}
		}
		while = {
			count = 4
			random_planet = {
				limit = {
					human_fallen_empires_trigger_plague_can_start_at_planet = yes
				}
				planet_event = {
					id = human_fallen_empires_plague.1 days = 1 random = 365
				}
			}
		}
		if = {
			limit = {
				is_difficulty > 0
			}
			while = {
				count = 2
				random_planet = {
					limit = {
						human_fallen_empires_trigger_plague_can_start_at_planet = yes
					}
					planet_event = {
						id = human_fallen_empires_plague.1 days = 1 random = 365
					}
				}
			}
		}
		if = {
			limit = {
				is_difficulty > 1
			}
			while = {
				count = 2
				random_planet = {
					limit = {
						human_fallen_empires_trigger_plague_can_start_at_planet = yes
					}
					planet_event = {
						id = human_fallen_empires_plague.1 days = 1 random = 365
					}
				}
			}
		}
		if = {
			limit = {
				is_difficulty > 2
			}
			while = {
				count = 2
				random_planet = {
					limit = {
						human_fallen_empires_trigger_plague_can_start_at_planet = yes
					}
					planet_event = {
						id = human_fallen_empires_plague.1 days = 1 random = 365
					}
				}
			}
		}
		every_country = {
			limit = {
				is_ai = no
			}
			country_event = {
				id = human_fallen_empires_plague.50 days = 1 random = 15
			}
		}
		create_species = {
		 	name = "Zombies"
		 	class = random_non_machine
		 	portrait = random
		 	traits = random
		}
		create_country = {
			name = "Zombies"
			species = last_created_species
			type = human_fallen_empires_plague_zombie
			effect = {
				save_event_target_as = human_fallen_empires_plague_zombie_country
			}
		}
	}
}

# start on planet 1
planet_event = {
	id = human_fallen_empires_plague.1
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		nor = {
			has_global_flag = human_fallen_empires_disable_plague
			has_planet_flag = human_fallen_empires_plague_planet
		}
		any_owned_pop = {
			human_fallen_empires_trigger_plague_is_immune = no
		}
	}

	immediate = {
		set_timed_planet_flag = {
			flag = human_fallen_empires_plague_planet days = 3650
		}
		every_owned_pop = {
			limit = {
				human_fallen_empires_trigger_plague_is_immune = no
			}
			set_timed_pop_flag = {
				flag = human_fallen_empires_plague_pop days = 3650
			}
		}
		every_playable_country = {
			limit = {
				has_event_chain = human_fallen_empires_plague_count
			}
			add_event_chain_counter = {
				event_chain = human_fallen_empires_plague_count
				counter = human_fallen_empires_plague_infested_planet_total
				amount = 1
			}
		}
		log = "Plague start on planet [Root.GetName] owner: [Root.Owner.GetName]"
		# set modifier and inform
		if = {
			limit = {
				has_global_flag = human_fallen_empires_plague_lvl_3
			}
			add_modifier = {
				modifier = human_fallen_empires_plague_lvl_3
				days = 3650
			}
			owner = {
				country_event = {
					id = human_fallen_empires_plague.55 days = 1 random = 15
				}
			}
			else = {
				if = {
					limit = {
						has_global_flag = human_fallen_empires_plague_lvl_2
					}
					add_modifier = {
						modifier = human_fallen_empires_plague_lvl_2
						days = 3650
					}
					owner = {
						country_event = {
							id = human_fallen_empires_plague.54 days = 1 random = 15
						}
					}
					else = {
						add_modifier = {
							modifier = human_fallen_empires_plague_lvl_1
							days = 3650
						}
						owner = {
							country_event = {
								id = human_fallen_empires_plague.53 days = 1 random = 15
							}
						}
					}
				}
			}
		}
		# lvl up plague
		event_target:human_fallen_empires_plague_count = {
			change_variable = {
				which = human_fallen_empires_plague_planet_num
				value = 1
			}
		}
		if = {
			limit = {
				not = {
					has_global_flag = human_fallen_empires_plague_lvl_2
				}
				event_target:human_fallen_empires_plague_count = {
					check_variable = {
						which = human_fallen_empires_plague_planet_num
						value > 30
					}
				}
			}
			set_global_flag = human_fallen_empires_plague_lvl_2
			every_playable_country = {
				add_research_option = tech_human_fallen_empires_plague_study
				country_event = {
					id = human_fallen_empires_plague.51 days = 1
				}
			}
		}
		if = {
			limit = {
				not = {
					has_global_flag = human_fallen_empires_plague_lvl_3
				}
				event_target:human_fallen_empires_plague_count = {
					check_variable = {
						which = human_fallen_empires_plague_planet_num
						value > 60
					}
				}
			}
			set_global_flag = human_fallen_empires_plague_lvl_3
			every_playable_country = {
				country_event = {
					id = human_fallen_empires_plague.52 days = 1
				}
			}
		}
		# pulse events
		planet_event = {
			id = human_fallen_empires_plague.2
		}
		planet_event = {
			id = human_fallen_empires_plague.6
		}
		owner = {
			save_event_target_as = human_fallen_empires_plague_planet_owner
			if = {
				limit = {
					has_event_chain = human_fallen_empires_plague_count
				}
				add_event_chain_counter = {
					event_chain = human_fallen_empires_plague_count
					counter = human_fallen_empires_plague_infested_planet
					amount = 1
				}
			}
		}
		# check planet after 10 years
		planet_event = {
			id = human_fallen_empires_plague.4 days = 3651
		}
	}
}

# kill pop pulse 2
planet_event = {
	id = human_fallen_empires_plague.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_disable_plague
		}
		exists = owner
		has_planet_flag = human_fallen_empires_plague_planet
		any_owned_pop = {
			human_fallen_empires_trigger_plague_is_immune = no
		}
	}

	immediate = {
		planet_event = {
			id = human_fallen_empires_plague.2 days = 180 random = 180
		}
		# log = "Plague pulse on planet [Root.GetName] owner: [Root.Owner.GetName]"
		# kill someone
		if = {
			limit = {
				has_global_flag = human_fallen_empires_plague_lvl_2
			}
			random_list = {
				# die
				90 = {
					modifier = {
						factor = 0.75
						has_building = building_clinic
					}
					modifier = {
						factor = 0.5
						has_building = building_hospital
					}
					owner = {
						country_event = {
							id = human_fallen_empires_plague.56 days = 1
						}
						if = {
							limit = {
								has_event_chain = human_fallen_empires_plague_count
							}
							add_event_chain_counter = {
								event_chain = human_fallen_empires_plague_count
								counter = human_fallen_empires_plague_kill_pop_count
								amount = 1
							}
						}
					}
					every_playable_country = {
						limit = {
							has_event_chain = human_fallen_empires_plague_count
						}
						add_event_chain_counter = {
							event_chain = human_fallen_empires_plague_count
							counter = human_fallen_empires_plague_kill_pop_count_total
							amount = 1
						}
					}
					if = {
						limit = {
							has_global_flag = human_fallen_empires_plague_lvl_3
							count_planet_army = {
								count < 25
							}
						}
						human_fallen_empires_plague_get_zombie = yes
						create_army = {
					 		name = Zombies
					 		owner = event_target:human_fallen_empires_plague_zombie_country
					 		type = human_fallen_empires_plague_zombie_army
						}
						every_playable_country = {
							limit = {
								has_event_chain = human_fallen_empires_plague_count
							}
							add_event_chain_counter = {
								event_chain = human_fallen_empires_plague_count
								counter = human_fallen_empires_plague_zombie_count_total
								amount = 1
							}
						}
					}
					random_owned_pop = {
						limit = {
							human_fallen_empires_trigger_plague_is_immune = no
						}
						kill_pop = yes
					}
				}
				# get immune
				1 = {
					modifier = {
						factor = 2
						owner = {
							is_ai = yes
						}
					}
					modifier = {
						factor = 2
						is_difficulty < 2
					}
					modifier = {
						factor = 2
						is_difficulty = 0
					}
					owner = {
						country_event = {
							id = human_fallen_empires_plague.58 days = 1
						}
					}
					random_owned_pop = {
						limit = {
							human_fallen_empires_trigger_plague_is_immune = no
						}
						modify_species = {
							species = this
							add_trait = human_fallen_empires_trait_immune
						}
					}
				}
				# nothing
				9 = {
				}
			}
		}
	}
}

# send plague pulse 6
planet_event = {
	id = human_fallen_empires_plague.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		not = {
			has_global_flag = human_fallen_empires_disable_plague
		}
		exists = owner
		has_planet_flag = human_fallen_empires_plague_planet
		any_owned_pop = {
			human_fallen_empires_trigger_plague_is_immune = no
		}
	}

	immediate = {
		planet_event = {
			id = human_fallen_empires_plague.6 days = 720 random = 180
		}
		# send plague
		random_system = {
			limit = {
				distance = {
					source = root
					max_distance = 30
					min_distance = 0
				}
				any_planet = {
					exists = owner
					owner = {
						or = {
							is_country_type = default
							is_country_type = awakened_fallen_empire
						}
					}
					is_under_colonization = no
					num_pops > 0
					nor = {
						has_planet_flag = human_fallen_empires_plague_planet
						controller = {
							is_country_type = human_fallen_empires_plague_zombie
						}
					}
					any_owned_pop = {
						human_fallen_empires_trigger_plague_is_immune = no
					}
				}
			}
			random_planet = {
				limit = {
					human_fallen_empires_trigger_plague_can_start_at_planet = yes
				}
				random_list = {
					# nothing
					10 = {
						modifier = {
							factor = 1.1
							has_building = building_clinic
						}
						modifier = {
							factor = 1.2
							has_building = building_hospital
						}
						modifier = {
							factor = 1.2
							habitable_structure = yes
						}
						modifier = {
							factor = 2
							has_global_flag = human_fallen_empires_plague_lvl_2
						}
						modifier = {
							factor = 1.5
							owner = {
								or = {
									has_country_flag = human_fallen_empires_egypt
									has_country_flag = human_fallen_empires_future
									is_country_type = awakened_fallen_empire
								}
							}
						}
						modifier = {
							factor = 1.2
							owner = {
								has_country_edict = human_fallen_empires_plague_quarantine
							}
						}
						modifier = {
							factor = 1.2
							owner = {
								not = {
									is_country = root.owner
								}
								has_closed_borders = root.owner
							}
						}
						log = "not send plague"
					}
					# send plague
					10 = {
						modifier = {
							factor = 1.2
							num_pops > 10
						}
						modifier = {
							factor = 1.4
							num_pops > 20
						}
						planet_event = {
							id = human_fallen_empires_plague.1 days = 180 random = 180
						}
						log = "send plague"
					}
				}
			}
		}
	}
}

# start by migration 3
pop_event = {
	id = human_fallen_empires_plague.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_pop_flag = human_fallen_empires_plague_pop
		exists = planet
	}

	immediate = {
		planet = {
			planet_event = {
				id = human_fallen_empires_plague.1
			}
			log = "Plague migration on planet [This.GetName] owner: [Root.Owner.GetName]"
		}
	}
}

# reduce the counter after 10 years
planet_event = {
	id = human_fallen_empires_plague.4
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_playable_country = {
			limit = {
				has_event_chain = human_fallen_empires_plague_count
			}
			add_event_chain_counter = {
				event_chain = human_fallen_empires_plague_count
				counter = human_fallen_empires_plague_infested_planet_total
				amount = -1
			}
		}
		if = {
			limit = {
				exists = owner
				owner = {
					not = {
						is_country_type = human_fallen_empires_plague_zombie
					}
				}
			}
			owner = {
				if = {
					limit = {
						has_event_chain = human_fallen_empires_plague_count
					}
					add_event_chain_counter = {
						event_chain = human_fallen_empires_plague_count
						counter = human_fallen_empires_plague_infested_planet
						amount = -1
					}
				}
			}
			else = {
				every_playable_country = {
					limit = {
						has_event_chain = human_fallen_empires_plague_count
					}
					add_event_chain_counter = {
						event_chain = human_fallen_empires_plague_count
						counter = human_fallen_empires_plague_kill_planet_count_total
						amount = 1
					}
				}
				event_target:human_fallen_empires_plague_planet_owner = {
					country_event = {
						id = human_fallen_empires_plague.61
					}
					if = {
						limit = {
							has_event_chain = human_fallen_empires_plague_count
						}
						add_event_chain_counter = {
							event_chain = human_fallen_empires_plague_count
							counter = human_fallen_empires_plague_kill_planet_count
							amount = 1
						}
						add_event_chain_counter = {
							event_chain = human_fallen_empires_plague_count
							counter = human_fallen_empires_plague_infested_planet
							amount = -1
						}
					}
				}
			}
		}
	}
}

# zombies take planet for on_planet_occupied
planet_event = {
	id = human_fallen_empires_plague.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		exists = fromfrom
		fromfrom = {
			is_country_type = human_fallen_empires_plague_zombie
		}
	}

	immediate = {
		log = "Plague zombies take planet [This.GetName] owner: [From.GetName]"
		owner = {
			country_event = {
				id = human_fallen_empires_plague.62
			}
		}
		fromfrom = {
			every_owned_fleet = {
				destroy_fleet = this
			}
		}
		every_planet_army = {
			limit = {
				not = {
					army_type = human_fallen_empires_plague_zombie_army
				}
			}
			remove_army = yes
		}
		every_owned_pop = {
			kill_pop = yes
		}
		set_owner = fromfrom
	}
}

# retake zombie planet for on_planet_occupied
planet_event = {
	id = human_fallen_empires_plague.7
	title = human_fallen_empires_plague.7.name
	desc = human_fallen_empires_plague.7.desc
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	is_triggered_only = yes
	location = root

	trigger = {
		exists = from
		from = {
			is_country_type = human_fallen_empires_plague_zombie
		}
		exists = fromfrom
		# fromfrom = {
		# 	not = {
		# 		is_country_type = human_fallen_empires_plague_zombie
		# 	}
		# }
	}

	immediate = {
		log = "Take planet[This.GetName] from zombies new owner: [Root.Owner.GetName]"
		every_planet_army = {
			limit = {
				army_type = human_fallen_empires_plague_zombie_army
			}
			remove_army = yes
		}
		set_owner = fromfrom
	}

	option = {
		name = human_fallen_empires_plague.7.0
	}
}

# report event after lvl 2 for on_tech_increased
country_event = {
	id = human_fallen_empires_plague.9
	title = human_fallen_empires_plague.9.name
	desc = {
		trigger = {
			text = human_fallen_empires_plague.9.desc.0
			success_text = {
				text = human_fallen_empires_plague.9.desc.1
				any_owned_planet = {
					habitable_structure = yes
				}
			}
			text = human_fallen_empires_plague.9.desc.2
		}
	}
	show_sound = event_laboratory_sound
	is_triggered_only = yes
	diplomatic = yes

	trigger = {
		last_increased_tech = tech_human_fallen_empires_plague_study
	}

	immediate = {
		random_owned_leader = {
			limit = {
				leader_class = scientist
			}
			save_event_target_as = human_fallen_empires_plague_scientist_portrait
		}
	}

	picture_event_data = {
		portrait = event_target:human_fallen_empires_plague_scientist_portrait
		room = human_fallen_empires_lab_room
	}

	option = {
		name = human_fallen_empires_plague.9.0
		custom_tooltip = human_fallen_empires_plague.9.0.tooltip
		hidden_effect = {
			country_event = {
				id = human_fallen_empires_plague.10 days = 2
			}
		}
	}
}

# second diplo event
country_event = {
	id = human_fallen_empires_plague.10
	title = human_fallen_empires_plague.10.name
	desc = {
		trigger = {
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.0.0
				human_fallen_empires_trigger_is_xenophobe = yes
				has_authority = auth_democratic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.0.1
				human_fallen_empires_trigger_is_xenophobe = yes
				has_authority = auth_oligarchic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.0.2
				human_fallen_empires_trigger_is_xenophobe = yes
				has_authority = auth_dictatorial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.0.3
				human_fallen_empires_trigger_is_xenophobe = yes
				has_authority = auth_imperial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.1.0
				human_fallen_empires_trigger_is_xenophile = yes
				has_authority = auth_democratic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.1.1
				human_fallen_empires_trigger_is_xenophile = yes
				has_authority = auth_oligarchic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.1.2
				human_fallen_empires_trigger_is_xenophile = yes
				has_authority = auth_dictatorial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.1.3
				human_fallen_empires_trigger_is_xenophile = yes
				has_authority = auth_imperial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.2.0
				has_militarist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_democratic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.2.1
				has_militarist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_oligarchic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.2.2
				has_militarist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_dictatorial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.2.3
				has_militarist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_imperial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.3.0
				has_pacifist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_democratic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.3.1
				has_pacifist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_oligarchic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.3.2
				has_pacifist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_dictatorial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.3.3
				has_pacifist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_imperial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.4.0
				has_spiritualist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_democratic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.4.1
				has_spiritualist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_oligarchic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.4.2
				has_spiritualist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_dictatorial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.4.3
				has_spiritualist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_imperial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.5.0
				has_materialist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_democratic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.5.1
				has_materialist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_oligarchic
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.5.2
				has_materialist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_dictatorial
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.5.3
				has_materialist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
				has_authority = auth_imperial
			}
			# other for now xenophiles
			success_text = {
				text = human_fallen_empires_plague.10.desc.0.1.0
				has_militarist_government = no
				has_pacifist_government = no
				has_spiritualist_government = no
				has_materialist_government = no
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.0
				human_fallen_empires_trigger_is_xenophobe = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.1
				human_fallen_empires_trigger_is_xenophile = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.2
				has_militarist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.3
				has_pacifist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.4
				has_spiritualist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.5
				has_materialist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			# other for now xenophiles
			success_text = {
				text = human_fallen_empires_plague.10.desc.1.3
				has_militarist_government = no
				has_pacifist_government = no
				has_spiritualist_government = no
				has_materialist_government = no
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.2.0
				has_policy_flag = refugees_allowed
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.0
				human_fallen_empires_trigger_is_xenophobe = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.1
				human_fallen_empires_trigger_is_xenophile = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.2
				has_militarist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.3
				has_pacifist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.4
				has_spiritualist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.5
				has_materialist_government = yes
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			# other for now xenophiles
			success_text = {
				text = human_fallen_empires_plague.10.desc.3.3
				has_militarist_government = no
				has_pacifist_government = no
				has_spiritualist_government = no
				has_materialist_government = no
				human_fallen_empires_trigger_is_xenophobe = no
				human_fallen_empires_trigger_is_xenophile = no
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.4.0
				has_authority = auth_democratic
				allows_purge = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.4.1
				has_authority = auth_oligarchic
				allows_purge = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.4.2
				has_authority = auth_dictatorial
				allows_purge = yes
			}
			success_text = {
				text = human_fallen_empires_plague.10.desc.4.3
				has_authority = auth_imperial
				allows_purge = yes
			}
		}
	}
	show_sound = event_celebration
	is_triggered_only = yes
	diplomatic = yes

	trigger = {
		human_fallen_empires_trigger_is_hive = no
	}

	immediate = {
		random_owned_leader = {
			limit = {
				leader_class = ruler
			}
			save_event_target_as = human_fallen_empires_plague_ruler_portrait
		}
	}

	picture_event_data = {
		portrait = event_target:human_fallen_empires_plague_ruler_portrait
		room = ethic_spaceship_room
		# planet_background = root
		# graphical_culture = root
		# city_level = root
		# room = root
	}

	option = {
		name = human_fallen_empires_plague.10.0
		add_modifier = {
			modifier = human_fallen_empires_unity
			days = 365
		}
	}
}

# inform events 50 - 100

# plague start inform
country_event = {
	id = human_fallen_empires_plague.50
	title = human_fallen_empires_plague.50.name
	desc = human_fallen_empires_plague.50.desc
	picture = GFX_evt_news_room
	show_sound = event_laboratory_sound
	is_triggered_only = yes

	trigger = {
		is_ai = no
	}

	option = {
		name = human_fallen_empires_plague.50.0
	}
	option = {
		name = human_fallen_empires_plague.50.1
		trigger = {
			has_trait = trait_mechanical
			human_fallen_empires_trigger_is_xenophobe = yes
		}
		human_fallen_empires_effect_xenophobe_attraction_low = yes
	}
	option = {
		name = human_fallen_empires_plague.50.2
		trigger = {
			human_fallen_empires_trigger_is_brainworm_country = yes
		}
	}
}

# plague lvl 2 inform
country_event = {
	id = human_fallen_empires_plague.51
	title = human_fallen_empires_plague.51.name
	desc = human_fallen_empires_plague.51.desc
	picture = GFX_evt_news_room
	show_sound = event_laboratory_sound
	is_triggered_only = yes

	trigger = {
		is_ai = no
	}

	option = {
		name = CURSES
		tooltip = {
			add_research_option = tech_human_fallen_empires_plague_study
		}
	}
}

# plague lvl 3 inform
country_event = {
	id = human_fallen_empires_plague.52
	title = human_fallen_empires_plague.52.name
	desc = human_fallen_empires_plague.52.desc
	picture = GFX_evt_news_room
	show_sound = event_laboratory_sound
	is_triggered_only = yes

	trigger = {
		is_ai = no
	}

	option = {
		name = DISCONCERTING
	}
}

# plague on our planet lvl 1
country_event = {
	id = human_fallen_empires_plague.53
	title = human_fallen_empires_plague.53.name
	desc = human_fallen_empires_plague.53.desc
	picture = GFX_evt_news_room
	show_sound = event_administrative_work
	is_triggered_only = yes
	location = from

	trigger = {
		is_ai = no
		not = {
			has_country_flag = human_fallen_empires_plague_block_planet
		}
	}

	option = {
		name = human_fallen_empires_plague.53.0
	}
	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_plague_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_plague_block_planet
		}
	}
}

# plague on our planet lvl 2
country_event = {
	id = human_fallen_empires_plague.54
	title = human_fallen_empires_plague.54.name
	desc = human_fallen_empires_plague.54.desc
	picture = GFX_evt_human_fallen_empires_plague
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	location = from

	trigger = {
		is_ai = no
		not = {
			has_country_flag = human_fallen_empires_plague_block_planet
		}
	}

	option = {
		name = human_fallen_empires_plague.54.0
	}
	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_plague_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_plague_block_planet
		}
	}
}

# plague on our planet lvl 3
country_event = {
	id = human_fallen_empires_plague.55
	title = human_fallen_empires_plague.55.name
	desc = human_fallen_empires_plague.55.desc
	picture = GFX_evt_human_fallen_empires_zombie
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	location = from

	trigger = {
		is_ai = no
		not = {
			has_country_flag = human_fallen_empires_plague_block_planet
		}
	}

	option = {
		name = human_fallen_empires_plague.55.0
	}
	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_plague_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_plague_block_planet
		}
	}
}

# plague on our planet pulse
country_event = {
	id = human_fallen_empires_plague.56
	title = human_fallen_empires_plague.56.name
	desc = {
		trigger = {
			fail_text = {
				text = human_fallen_empires_plague.56.desc.0
				has_global_flag = human_fallen_empires_plague_lvl_3
			}
			success_text = {
				text = human_fallen_empires_plague.56.desc.1
				has_global_flag = human_fallen_empires_plague_lvl_3
			}
		}
	}
	picture = GFX_evt_human_fallen_empires_plague
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	location = from

	trigger = {
		is_ai = no
		not = {
			has_country_flag = human_fallen_empires_plague_block_pulse
		}
	}

	option = {
		name = human_fallen_empires_plague.56.0
		trigger = {
			not = {
				has_global_flag = human_fallen_empires_plague_lvl_3
			}
		}
	}
	option = {
		name = human_fallen_empires_plague.56.1
		trigger = {
			has_global_flag = human_fallen_empires_plague_lvl_3
		}
	}
	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_plague_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_plague_block_pulse
		}
	}
}

# # plague on our planet lvl 3 pulse
# country_event = {
# 	id = human_fallen_empires_plague.57
# 	title = human_fallen_empires_plague.57.name
# 	desc = human_fallen_empires_plague.57.desc
# 	picture = GFX_evt_human_fallen_empires_zombie
# 	show_sound = event_air_raid_siren
# 	is_triggered_only = yes
# 	location = from

# 	trigger = {
# 		is_ai = no
# 		not = {
# 			has_country_flag = human_fallen_empires_plague_block_pulse
# 		}
# 	}

# 	option = {
# 		name = human_fallen_empires_plague.57.0
# 	}
# 	option = {
# 		name = human_fallen_empires_block
# 		custom_tooltip = human_fallen_empires_plague_block.tooltip
# 		hidden_effect = {
# 			set_country_flag = human_fallen_empires_plague_block_pulse
# 		}
# 	}
# }

# pop gain immune
country_event = {
	id = human_fallen_empires_plague.58
	title = human_fallen_empires_plague.58.name
	desc = human_fallen_empires_plague.58.desc
	picture = GFX_evt_human_fallen_empires_lab
	show_sound = event_celebration
	is_triggered_only = yes
	location = from

	trigger = {
		not = {
			has_technology = tech_human_fallen_empires_plague_immune
		}
	}

	option = {
		name = human_fallen_empires_plague.58.0
		trigger = {
			not = {
				has_country_flag = human_fallen_empires_plague_know_immune
			}
		}
		add_research_option = tech_human_fallen_empires_plague_immune
		set_country_flag = human_fallen_empires_plague_know_immune
		log = "[Root.GetName] now know immune"
	}
	option = {
		name = human_fallen_empires_plague.58.1
		trigger = {
			has_country_flag = human_fallen_empires_plague_know_immune
		}
		add_tech_progress = {
			tech = tech_human_fallen_empires_plague_immune
			progress = 0.01
		}
	}
}

# everyone die on planet notification for owner
country_event = {
	id = human_fallen_empires_plague.61
	title = human_fallen_empires_plague.61.name
	desc = human_fallen_empires_plague.61.desc
	picture = GFX_evt_human_fallen_empires_ruins
	show_sound = event_ghost_town
	is_triggered_only = yes
	location = from

	trigger = {
		is_ai = no
		exists = from
		from = {
			not = {
				has_planet_flag = human_fallen_empires_plague_bombardment_planet
			}
		}
		not = {
			has_country_flag = human_fallen_empires_plague_block_all_die
		}
	}

	option = {
		name = human_fallen_empires_plague.61.0
	}

	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_plague_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_plague_block_all_die
		}
	}
}

# everyone die on planet notification for owner
country_event = {
	id = human_fallen_empires_plague.62
	title = human_fallen_empires_plague.62.name
	desc = human_fallen_empires_plague.62.desc
	picture = GFX_evt_human_fallen_empires_zombie
	is_triggered_only = yes
	location = from

	trigger = {
		is_ai = no
		not = {
			has_country_flag = human_fallen_empires_plague_block_zombie
		}
	}

	option = {
		name = human_fallen_empires_plague.62.0
	}
	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_plague_block.tooltip
		hidden_effect = {
			set_country_flag = human_fallen_empires_plague_block_zombie
		}
	}
}

# events on first plague planet 100 - 150
planet_event = {
	id = human_fallen_empires_plague.100
	title = human_fallen_empires_plague.100.name
	desc = human_fallen_empires_plague.100.desc
	picture = GFX_evt_human_fallen_empires_plague
	show_sound = event_air_raid_siren
	is_triggered_only = yes
	location = root

	trigger = {
		exists = owner
		owner = {
			not = {
				has_country_flag = human_fallen_empires_plague_fist_time
			}
		}
	}

	immediate = {
		set_timed_planet_flag = {
			flag = human_fallen_empires_plague_fist_planet days = 3650
		}
		owner = {
			set_country_flag = human_fallen_empires_plague_fist_time
		}
	}

	option = {
		name = human_fallen_empires_plague.100.0
	}
}

# bombardment event 150 - 200
# bombarding infected planet after project finished
ship_event = {
	id = human_fallen_empires_plague.150
	title = human_fallen_empires_plague.150.name
	desc = human_fallen_empires_plague.150.desc
	picture = GFX_evt_ground_combat
	show_sound = event_ground_battle
	is_triggered_only = yes
	location = root

	immediate = {
		event_target:human_fallen_empires_project_plague_planet_bombardment_target = {
			log = "Bombard plague planet [This.GetName] owner [Owner.GetName]"
			set_timed_planet_flag = {
				flag = human_fallen_empires_plague_bombardment_planet
				days = 3650
			}
			if = {
				limit = {
					num_pops > 0
				}
				random_owned_pop = {
					save_event_target_as = human_fallen_empires_plague_purged_species
				}
				owner = {
					every_relation = {
						limit = {
							not = {
								is_same_species = event_target:human_fallen_empires_plague_purged_species
							}
							allows_purge = no
							or = {
								is_country_type = default
								has_ai_personality = awakened_fallen_empire_xenophile
							}
						}
						add_opinion_modifier = {
							who = root.owner
							modifier = opinion_genocidal
						}
					}
					every_relation = {
						limit = {
							is_same_species = event_target:human_fallen_empires_plague_purged_species
							allows_purge = no
						}
						add_opinion_modifier = {
							who = root.owner
							modifier = opinion_genocidal_our_species
						}
					}
				}
			}
			human_fallen_empires_effect_plague_planet_clean = yes
			destroy_colony = {
				keep_buildings = no
			}
			add_modifier = {
				modifier = human_fallen_empires_plague_bombardment_planet
				days = 36500
			}
		}
		# добавить эвенты адмирала
	}

	option = {
		name = human_fallen_empires_plague.150.0
	}
	option = {
		name = human_fallen_empires_block
		custom_tooltip = human_fallen_empires_block.tooltip
		hidden_effect = {
			owner = {
				set_country_flag = human_fallen_empires_plague.150_block
			}
		}
	}
}

# check if planet still has owner
ship_event = {
	id = human_fallen_empires_plague.151
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		event_target:human_fallen_empires_project_plague_planet_bombardment_target = {
			has_owner = no
		}
	}

	immediate = {
		owner = {
			abort_special_project = {
				type = human_fallen_empires_project_plague_planet_bombardment
				location = event_target:human_fallen_empires_project_plague_planet_bombardment_target
			}
		}
	}
}

# first plagued colony events 150 - 200
