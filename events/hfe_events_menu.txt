namespace = hfe_menu

# menu
country_event = {
	id = hfe_menu.1
	title = hfe_menu.1.name
	desc = {
		trigger = {
			text = hfe_menu.1.desc.0
			success_text = {
				text = hfe_menu.1.desc.1.0
				has_global_flag = hfe_installed
			}
			fail_text = {
				text = hfe_menu.1.desc.1.1
				has_global_flag = hfe_installed
			}
			success_text = {
				text = hfe_menu.1.desc.2.0
				exists = event_target:hfe_egypt_country
			}
			fail_text = {
				text = hfe_menu.1.desc.2.1
				exists = event_target:hfe_egypt_country
			}
			success_text = {
				text = hfe_menu.1.desc.3.0
				exists = event_target:hfe_future_country
			}
			fail_text = {
				text = hfe_menu.1.desc.3.1
				exists = event_target:hfe_future_country
			}
			success_text = {
				text = hfe_menu.1.desc.4.0
				has_global_flag = hfe_plague_started
			}
			fail_text = {
				text = hfe_menu.1.desc.4.1
				has_global_flag = hfe_plague_started
			}
		}
	}
	picture = {
		trigger = {
			has_country_flag = hfe_random_0
		}
		picture = GFX_evt_hfe_fallen
	}
	picture = {
		trigger = {
			has_country_flag = hfe_random_1
		}
		picture = GFX_evt_hfe_fallen_2
	}
	picture = {
		trigger = {
			has_country_flag = hfe_random_2
		}
		picture = GFX_evt_hfe_fallen_3
	}
	is_triggered_only = yes

	immediate = {
		hfe_effect_random_roll_flags_3_country = yes
	}

	# make humans undivided
	option = {
		name = hfe_menu.0
		custom_tooltip = hfe_menu.0.tooltip
		trigger = {
			has_global_flag = hfe_installed
			has_country_flag = hfe_marked_as_human
		}
		hidden_effect = {
			species = {
				save_event_target_as = hfe_human_species
			}
			every_country = {
				limit = {
					has_country_flag = hfe_marked_as_human
					species = {
						not = {
							is_same_species = event_target:hfe_human_species
						}
					}
				}
				species = {
					set_species_identity = event_target:hfe_human_species
				}
			}
			every_owned_pop_species = {
				limit = {
					species_portrait = human
					not = {
						is_same_species = event_target:hfe_human_species
					}
				}
				set_species_identity = event_target:hfe_human_species
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	option = {
		name = hfe_menu.1
		custom_tooltip = hfe_menu.1.tooltip
		trigger = {
			has_global_flag = hfe_installed
			not = {
				has_country_flag = hfe_marked_as_human
			}
		}
		hidden_effect = {
			set_country_flag = hfe_marked_as_human
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable pirate
	option = {
		name = hfe_menu.2.on
		trigger = {
			has_global_flag = hfe_disable_pirate
		}
		custom_tooltip = hfe_menu.2.on.tooltip
		hidden_effect = {
			remove_global_flag = hfe_disable_pirate
			every_country = {
				limit = {
					is_country_type = default
				}
				set_country_flag = pirates_spawned
			}
			every_country = {
				limit = {
					is_country_type = pirate
				}
				destroy_country = yes
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	option = {
		name = hfe_menu.2.off
		trigger = {
			not = {
				has_global_flag = hfe_disable_pirate
			}
		}
		custom_tooltip = hfe_menu.2.off.tooltip
		hidden_effect = {
			set_global_flag = hfe_disable_pirate
			every_country = {
				limit = {
					is_country_type = default
				}
				remove_country_flag = pirates_spawned
			}
			every_country = {
				limit = {
					is_country_type = hfe_pirate
				}
				every_owned_planet = {
					hfe_effect_convert_to_asteroid = yes
				}
				destroy_country = yes
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable planet decay
	option = {
		name = hfe_menu.3.on
		trigger = {
			has_global_flag = hfe_disable_planet_decay
		}
		custom_tooltip = hfe_menu.3.on.tooltip
		hidden_effect = {
			remove_global_flag = hfe_disable_planet_decay
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	option = {
		name = hfe_menu.3.off
		trigger = {
			not = {
				has_global_flag = hfe_disable_planet_decay
			}
		}
		custom_tooltip = hfe_menu.3.off.tooltip
		hidden_effect = {
			set_global_flag = hfe_disable_planet_decay
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable population
	option = {
		name = hfe_menu.4.on
		trigger = {
			hfe_trigger_population_enabled = no
		}
		custom_tooltip = hfe_menu.4.on.tooltip
		hidden_effect = {
			remove_global_flag = hfe_population_disable
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	option = {
		name = hfe_menu.4.off
		trigger = {
			hfe_trigger_population_enabled = yes
		}
		custom_tooltip = hfe_menu.4.off.tooltip
		hidden_effect = {
			every_planet = {
				limit = {
					or = {
						has_modifier = hfe_population_yellow_ring
						has_modifier = hfe_population_red_ring
						has_modifier = hfe_population_green_ring
						has_modifier = hfe_population_blue_ring
					}
				}
				remove_modifier = hfe_population_yellow_ring
				remove_modifier = hfe_population_red_ring
				remove_modifier = hfe_population_green_ring
				remove_modifier = hfe_population_blue_ring
			}
			set_global_flag = hfe_population_disable
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable plague
	option = {
		name = hfe_menu.5.on
		trigger = {
			has_global_flag = hfe_disable_plague
		}
		custom_tooltip = hfe_menu.5.on.tooltip
		hidden_effect = {
			remove_global_flag = hfe_disable_plague
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	option = {
		name = hfe_menu.5.off
		trigger = {
			not = {
				has_global_flag = hfe_disable_plague
			}
		}
		custom_tooltip = hfe_menu.5.off.tooltip
		hidden_effect = {
			set_global_flag = hfe_disable_plague
			remove_global_flag = hfe_plague_started
			remove_global_flag = hfe_plague_lvl_2
			remove_global_flag = hfe_plague_lvl_3
			every_planet = {
				limit = {
					or = {
						has_planet_flag = hfe_plague_planet
						has_modifier = hfe_plague_lvl_1
						has_modifier = hfe_plague_lvl_2
						has_modifier = hfe_plague_lvl_3
					}
				}
				hfe_effect_plague_planet_clean = yes
			}
			every_country = {
				if = {
					limit = {
						is_country_type = hfe_plague_zombie
					}
					destroy_country = yes
				}
			}
			every_country = {
				limit = {
					has_event_chain = hfe_chain_plague_count
				}
				remove_country_flag = hfe_plague_block_planet
				remove_country_flag = hfe_plague_block_pulse
				end_event_chain = hfe_chain_plague_count
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable leaders recrutment
	option = {
		name = hfe_menu.7.0.defined_text
		custom_tooltip = hfe_menu.7.0.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					hfe_trigger_leaders_recrutment_enabled = yes
				}
				every_country = {
					limit = {
						has_modifier = hfe_leaders_started
					}
					remove_modifier = hfe_leaders_started
				}
				remove_global_flag = hfe_leaders_recrutment
			}
			else = {
				set_global_flag = hfe_leaders_recrutment
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable leaders traits
	option = {
		name = hfe_menu.7.1.defined_text
		custom_tooltip = hfe_menu.7.1.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					hfe_trigger_leaders_traits_enabled = yes
				}
				remove_global_flag = hfe_leaders_traits_disable
			}
			else = {
				set_global_flag = hfe_leaders_traits_disable
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# disable opinions
	option = {
		name = hfe_menu.8.defined_text
		custom_tooltip = hfe_menu.8.tooltip.defined_text
		hidden_effect = {
			if = {
				limit = {
					hfe_trigger_features_opinion_enabled = yes
				}
				remove_global_flag = hfe_features_opinion_disable
			}
			else = {
				set_global_flag = hfe_features_opinion_disable
			}
			country_event = {
				id = hfe_menu.1
			}
		}
	}
	# stats
	option = {
		name = hfe_menu.6
		hidden_effect = {
			country_event = {
				id = hfe_statistics.0
			}
		}
	}
	# customization
	option = {
		name = hfe_customization
		trigger = {
			exists = ruler
		}
		hidden_effect = {
			country_event = {
				id = hfe_customization.0
			}
		}
	}
	option = {
		name = modmenu_exit
		default_hide_option = yes
	}
}
