#
namespace = human_fallen_empires_pirate


@tier1materialreward = 6
@tier1materialmin = 100
@tier1materialmax = 500
@tier2materialreward = 12
@tier2materialmin = 150
@tier2materialmax = 1000
@tier3materialreward = 18
@tier3materialmin = 250
@tier3materialmax = 1500
@tier4materialreward = 24
@tier4materialmin = 350
@tier4materialmax = 2000

@tier1influencereward = 6
@tier1influencemin = 40
@tier1influencemax = 100
@tier2influencereward = 12
@tier2influencemin = 80
@tier2influencemax = 175
@tier3influencereward = 18
@tier3influencemin = 125
@tier3influencemax = 250
@tier4influencereward = 24
@tier4influencemin = 150
@tier4influencemax = 300

@tier1researchreward = 6
@tier1researchmin = 60
@tier1researchmax = 150
@tier2researchreward = 12
@tier2researchmin = 90
@tier2researchmax = 250
@tier3researchreward = 18
@tier3researchmin = 120
@tier3researchmax = 350
@tier4researchreward = 24
@tier4researchmin = 150
@tier4researchmax = 500

# pirate
@human_fallen_empires_pirate_base_cost = 4000
@human_fallen_empires_pirate_base_cost_minus = -4000
@human_fallen_empires_pirate_slave_cost = 300
@human_fallen_empires_pirate_slave_cost_minus = -300
@human_fallen_empires_pirate_fleet_power_minimum = 4000
@human_fallen_empires_pirate_ravaged_planet_time = 365

@human_fallen_empires_blackjack_bet_0 = 100
@human_fallen_empires_blackjack_bet_1 = 250
@human_fallen_empires_blackjack_bet_2 = 500
@human_fallen_empires_blackjack_bet_3 = 1000
@human_fallen_empires_blackjack_bet_4 = 5000

@human_fallen_empires_blackjack_bet_0_minus = -100
@human_fallen_empires_blackjack_bet_1_minus = -250
@human_fallen_empires_blackjack_bet_2_minus = -500
@human_fallen_empires_blackjack_bet_3_minus = -1000
@human_fallen_empires_blackjack_bet_4_minus = -5000

# spawn pirate birth of piracy
country_event = {
	id = human_fallen_empires_pirate.1
	title = pirate.1.name
	picture = GFX_evt_human_fallen_empires_pirate
	show_sound = event_space_battle

	desc = { # Spiritual
		text = pirate.1.desc_01
		trigger = {
			has_spiritualist_government = yes
		}
	}

	desc = { # Militarist
		text = pirate.1.desc_02
		trigger = {
			has_militarist_government = yes
		}
	}

	desc = { # Materialist
		text = pirate.1.desc_03
		trigger = {
			has_materialist_government = yes
		}
	}

	desc = { # Pacifist
		text = pirate.1.desc_04
		trigger = {
			has_pacifist_government = yes
		}
	}

	desc = { # Generic Autocracy
		text = pirate.1.desc_05
		trigger = {
			OR = {
				has_government = gov_despotic_empire
				has_government = gov_feudal_empire
				has_government = gov_constitutional_dictatorship
				has_government = gov_enlightened_monarchy
				has_government = gov_elective_monarchy
			}
		}
	}

	desc = { # Generic Oligarchy
		text = pirate.1.desc_06
		trigger = {
			OR = {
				has_government = gov_megacorporation
				has_government = gov_plutocratic_oligarchy
			}
		}
	}

	desc = { # Generic Democracy
		text = pirate.1.desc_07
		trigger = {
			has_government = gov_representative_democracy
		}
	}

	trigger = {
		is_country_type = default
		not = {
			has_country_flag = human_fallen_empires_birth_of_piracy
		}
	}

	is_triggered_only = yes

	immediate = {
		# random_list = {
		# 	1 = { }
		# 	2 = {
		# 		break = yes
		# 	}
		# }
		log = "pirate spawned"
		set_country_flag = human_fallen_empires_birth_of_piracy
		set_country_flag = pirate_encountered
		save_event_target_as = human_fallen_empires_pirate_target
		random_system = {
			limit = {
				or = {
					distance = {
						source = root.capital_scope
						min_distance = 5
						max_distance = 50
					}
					any_planet = {
						is_neighbor_of = root
					}
				}
				nor = {
					any_planet = {
						exists = owner
					}
					has_star_flag = hostile_system
				}
				any_planet = {
					is_asteroid = yes
					nor = {
						exists = controller
						exists = owner
					}
				}
			}
			random_system_planet = {
				limit = {
					is_asteroid = yes
					nor = {
						exists = controller
						exists = owner
					}
				}
				human_fallen_empires_effect_create_pirate = yes
				human_fallen_empires_effect_create_pirate_base = yes
			}
		}
		every_country = {
			limit = {
				is_country_type = default
				has_country_flag = pirate_encountered
			}
			every_country = {
				limit = {
					or = {
						is_country_type = pirate
						is_country_type = human_fallen_empires_pirate
					}
				}
				establish_communications_no_message = prev
			}
		}
	}

	option = {
		name = pirate.2.a
		trigger = {
			has_spiritualist_government = yes
		}
	}
	option = {
		name = pirate.2.b
		trigger = {
			has_militarist_government = yes
		}
	}
	option = {
		name = pirate.2.c
		trigger = {
			has_materialist_government = yes
		}
	}
	option = {
		name = pirate.2.d
		trigger = {
			has_pacifist_government = yes
		}
	}
	option = {
		name = pirate.2.e
		trigger = {
			OR = {
				has_government = gov_despotic_empire
				has_government = gov_feudal_empire
				has_government = gov_constitutional_dictatorship
				has_government = gov_enlightened_monarchy
				has_government = gov_elective_monarchy
			}
		}
	}
	option = {
		name = pirate.2.f
		trigger = {
			OR = {
				has_government = gov_megacorporation
				has_government = gov_plutocratic_oligarchy
			}
		}
	}
	option = {
		name = pirate.2.g
		trigger = {
			has_government = gov_representative_democracy
		}
	}
	option = {
		name = INTERESTING
	}
}

# pirate life simulation
country_event = {
	id = human_fallen_empires_pirate.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = human_fallen_empires_pirate
	}

	immediate = {
		# build new bases
		country_event = { id = human_fallen_empires_pirate.3 }
		# send fleet logic for unstuck fleets
		every_owned_fleet = {
			fleet_event = { id = human_fallen_empires_pirate.50 }
		}
		# kick buildings
		every_owned_planet = {
			limit = {
				free_building_tiles > 0
			}
			every_tile = {
				limit = {
					exists = pop
					not = {
						has_building = human_fallen_empires_pirate_slave_pit
					}
				}
				add_building_construction = human_fallen_empires_pirate_slave_pit
			}
			# every_owned_pop = {
			# 	set_slavery_type = { country = root type = slavery_normal cooldown = yes }
			# }
		}
		# also cheat for better drives
		if = {
			limit = {
				years_passed > 20
			}
			if = {
				limit = {
					has_technology = tech_warp_drive_1
					not = {
						has_technology = tech_warp_drive_2
					}
				}
				give_technology = { tech = tech_warp_drive_2 }
			}
			if = {
				limit = {
					has_technology = tech_wormhole_generation_1
					not = {
						has_technology = tech_wormhole_generation_2
					}
				}
				give_technology = { tech = tech_wormhole_generation_2 }
			}
			if = {
				limit = {
					has_technology = tech_hyper_drive_1
					not = {
						has_technology = tech_wormhole_generation_3
					}
				}
				give_technology = { tech = tech_hyper_drive_2 }
			}
		}
		if = {
			limit = {
				years_passed > 40
			}
			if = {
				limit = {
					has_technology = tech_warp_drive_2
					not = {
						has_technology = tech_warp_drive_3
					}
				}
				give_technology = { tech = tech_warp_drive_3 }
			}
			if = {
				limit = {
					has_technology = tech_wormhole_generation_2
					not = {
						has_technology = tech_wormhole_generation_3
					}
				}
				give_technology = { tech = tech_wormhole_generation_3 }
			}
			if = {
				limit = {
					has_technology = tech_hyper_drive_2
					not = {
						has_technology = tech_hyper_drive_3
					}
				}
				give_technology = { tech = tech_hyper_drive_3 }
			}
		}
	}
}

# pirate build base
country_event = {
	id = human_fallen_empires_pirate.3
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		energy > @human_fallen_empires_pirate_base_cost
	}

	immediate = {
		save_event_target_as = pirate_band
		every_owned_planet = {
			random_system = {
				limit = {
					distance = {
						source = prev
						min_distance = 5
						max_distance = 50
					}
					nor = {
						any_planet = {
							exists = owner
						}
						any_ship_in_system = {
							is_ship_class = shipclass_military_station
						}
						has_star_flag = hostile_system
					}
					any_planet = {
						is_asteroid = yes
						nor = {
							exists = controller
							exists = owner
						}
					}
					root = {
						energy > @human_fallen_empires_pirate_base_cost
					}
				}
				random_system_planet = {
					limit = {
						is_asteroid = yes
						nor = {
							exists = controller
							exists = owner
						}
					}
					human_fallen_empires_effect_create_pirate_base = yes
					root = {
						add_energy = @human_fallen_empires_pirate_base_cost_minus
					}
				}
			}
		}
	}
}

# pirate fleet logic set by ship build on action
ship_event = {
	id = human_fallen_empires_pirate.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		is_ship_class = shipclass_military
	}

	immediate = {
		fleet = {
			fleet_event = { id = human_fallen_empires_pirate.50 }
		}
	}
}

# kill pirate base
country_event = {
	id = human_fallen_empires_pirate.5
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = from
		from = {
			is_country_type = human_fallen_empires_pirate
		}
		exists = fromfromfrom
		fromfromfrom = {
			is_ship_size = orbital_station
		}
		exists = fromfromfrom.orbit.planet
	}

	immediate = {
		from = {
			if = {
				limit = {
					num_owned_planets = 1
					any_country = {
						is_country_type = human_fallen_empires_pirate
					}
				}
				random_country = {
					limit = {
						is_country_type = human_fallen_empires_pirate
					}
					# попробовать через from и prevprev назначить владельца
					save_event_target_as = human_fallen_empires_pirate_new_owner
				}
				every_owned_fleet = {
					set_owner = event_target:human_fallen_empires_pirate_new_owner
				}
			}
			# destroy contry later for fix errors in log
			country_event = { id = human_fallen_empires.9 days = 2 }
			#	destroy_country = yes
		}
		fromfromfrom.orbit.planet = {
			if = {
				limit = {
					num_pops > 0
				}
				every_owned_pop = {
					limit = {
						not = {
							has_citizenship_type = { type = citizenship_purge country = root }
						}
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
					root = {
						human_fallen_empires_effect_settle_pop = yes
						human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
					}
				}
			}
			# добавить перемещение к любой другой империи
			destroy_colony = { keep_buildings = no }
			change_pc = pc_asteroid
		}
	}
}

# spawn pirate during game
country_event = {
	id = human_fallen_empires_pirate.6
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = default
		not = {
			has_country_flag = human_fallen_empires_pirate_spawned
		}
	}

	immediate = {
		log = "pirate spawned again"
		set_timed_country_flag = { flag = human_fallen_empires_pirate_spawned days = 1500 }
		save_event_target_as = human_fallen_empires_pirate_target
		random_system = {
			limit = {
				nor = {
					any_planet = {
						exists = owner
					}
					has_star_flag = hostile_system
				}
				any_planet = {
					is_asteroid = yes
					not = {
						exists = controller
					}
				}
			}
			random_system_planet = {
				limit = {
					is_asteroid = yes
					nor = {
						exists = controller
						exists = owner
					}
				}
				human_fallen_empires_effect_create_pirate = yes
				human_fallen_empires_effect_create_pirate_base = yes
			}
		}
		every_country = {
			limit = {
				is_country_type = default
				has_country_flag = pirate_encountered
			}
			every_country = {
				limit = {
					or = {
						is_country_type = pirate
						is_country_type = human_fallen_empires_pirate
					}
				}
				establish_communications_no_message = prev
			}
		}
	}
}

# functional fleet stuff 675 - 700

# pirate fleet logic
fleet_event = {
	id = human_fallen_empires_pirate.50
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		num_ships > 4
		has_hp_percentage > 0.99
		is_fleet_idle = yes
		any_system = {
			any_planet = {
				or = {
					and = {
						has_orbital_station = yes
						exists = controller
						controller = {
							is_country_type = default
							is_hostile = root.owner
						}
					}
					and = {
						exists = owner
						owner = {
							or = {
								is_country_type = default
								is_country_type = primitive
							}
							is_hostile = root.owner
						}
					}
				}
			}
			not = {
				any_ship_in_system = {
					or = {
						is_ship_size = orbital_station
						is_ship_class = shipclass_military
						is_ship_class = shipclass_military_station
					}
					exists = owner
					owner = {
						is_hostile = root.owner
					}
					root = {
						fleet_power < @human_fallen_empires_pirate_fleet_power_minimum
					}
				}
			}
		}
	}

	immediate = {
		#log = "pirate fleet logic"
		clear_fleet_actions = this
		queue_actions = {
			repeat = {
				# try found prior target
				find_closest_system = {
					trigger = {
						id = human_fallen_empires_pirate.50.trigger.0.0
						root = {
							has_hp_percentage > 0.99
						}
						any_country = {
							has_opinion_modifier = {
								who = root.owner
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
						any_planet = {
							or = {
								and = {
									has_orbital_station = yes
									exists = controller
									controller = {
										is_country_type = default
										is_hostile = root.owner
										has_opinion_modifier = {
											who = root.owner
											modifier = human_fallen_empires_opinion_pirate_prior_target
										}
									}
								}
								and = {
									human_fallen_empires_pirate_valid_target_planet = yes
									root.owner = {
										any_owned_planet = {
											free_pop_tiles > 0
										}
									}
									owner = {
										has_opinion_modifier = {
											who = root.owner
											modifier = human_fallen_empires_opinion_pirate_prior_target
										}
									}
								}
							}
						}
						not = {
							any_ship_in_system = {
								or = {
									is_ship_size = orbital_station
									is_ship_class = shipclass_military
									is_ship_class = shipclass_military_station
								}
								exists = owner
								owner = {
									is_hostile = root.owner
								}
								root = {
									fleet_power < @human_fallen_empires_pirate_fleet_power_minimum
								}
							}
						}
					}
					found_system = {
						effect = {
							id = human_fallen_empires_pirate.50.effect.0.0
							root = {
								if = {
									limit = {
										or = {
											num_ships < 5
											has_hp_percentage < 0.99
										}
									}
									clear_fleet_actions = this
									log = "pirate fleet stop operation due low hp"
								}
							}
						}
						move_to = this
					}
					failed = {
						# then try found other target
						find_closest_system = {
							trigger = {
								id = human_fallen_empires_pirate.50.trigger.0.1
								root = {
									has_hp_percentage > 0.99
								}
								any_planet = {
									or = {
										and = {
											has_orbital_station = yes
											exists = controller
											controller = {
												is_country_type = default
												is_hostile = root.owner
												not = {
													has_opinion_modifier = {
														who = root.owner
														modifier = human_fallen_empires_opinion_pirate_pay_for_protect
													}
												}
											}
										}
										and = {
											human_fallen_empires_pirate_valid_target_planet = yes
											root.owner = {
												any_owned_planet = {
													free_pop_tiles > 0
												}
											}
											owner = {
												not = {
													has_opinion_modifier = {
														who = root.owner
														modifier = human_fallen_empires_opinion_pirate_pay_for_protect
													}
												}
											}
										}
									}
								}
								not = {
									any_ship_in_system = {
										or = {
											is_ship_size = orbital_station
											is_ship_class = shipclass_military
											is_ship_class = shipclass_military_station
										}
										exists = owner
										owner = {
											is_hostile = root.owner
										}
										root = {
											fleet_power < @human_fallen_empires_pirate_fleet_power_minimum
										}
									}
								}
							}
							found_system = {
								effect = {
									id = human_fallen_empires_pirate.50.effect.0.1
									root = {
										if = {
											limit = {
												or = {
													num_ships < 5
													has_hp_percentage < 0.99
												}
											}
											clear_fleet_actions = this
											log = "pirate fleet stop operation due low hp"
										}
									}
								}
								move_to = this
							}
							failed = {
								# then try found planet if havent other targets
								find_closest_system = {
									trigger = {
										id = human_fallen_empires_pirate.50.trigger.0.2
										root = {
											has_hp_percentage > 0.99
										}
										any_planet = {
											human_fallen_empires_pirate_valid_target_planet = yes
											owner = {
												not = {
													has_opinion_modifier = {
														who = root.owner
														modifier = human_fallen_empires_opinion_pirate_pay_for_protect
													}
												}
											}
										}
										not = {
											any_ship_in_system = {
												or = {
													is_ship_size = orbital_station
													is_ship_class = shipclass_military
													is_ship_class = shipclass_military_station
												}
												exists = owner
												owner = {
													is_hostile = root.owner
												}
												root = {
													fleet_power < @human_fallen_empires_pirate_fleet_power_minimum
												}
											}
										}
									}
									found_system = {
										effect = {
											id = human_fallen_empires_pirate.50.effect.0.2
											root = {
												if = {
													limit = {
														or = {
															num_ships < 5
															has_hp_percentage < 0.99
														}
													}
													clear_fleet_actions = this
													log = "pirate fleet stop operation due low hp"
												}
											}
										}
										move_to = this
									}
									# then wait
									failed = {
										wait = 200
										effect = {
											id = human_fallen_empires_pirate.50.effect.0.3
											root = {
												clear_fleet_actions = this
												fleet_event = { id = human_fallen_empires_pirate.50 } # days = 200 }
												log = "pirate fleet stop operation due no targets"
											}
										}
									}
								}
							}
						}
					}
				}
				repeat = {
					max_iterations = 5
					find_closest_planet = {
						trigger = {
							id = human_fallen_empires_pirate.50.trigger.2
							root = {
								has_hp_percentage > 0.99
							}
							or = {
								has_orbital_station = yes
								human_fallen_empires_pirate_valid_target_planet = yes
							}
						}
						found_planet = {
							orbit_planet = this
							wait = 31
						}
					}
				}
				find_random_system = {
					trigger = {
						id = human_fallen_empires_pirate.50.trigger.3
						any_planet = {
							exists = owner
							owner = {
								is_country = root.owner
							}
						}
					}
					found_system = {
						move_to = this
					}
				}
				find_closest_planet = {
					trigger = {
						id = human_fallen_empires_pirate.50.trigger.4
						exists = owner
						owner = {
							is_country = root.owner
						}
					}
					found_planet = {
						orbit_planet = this
						wait = {
							duration = 200
							random = 150
						}
					}
				}
			}
		}
	}
}

# cleet fleet actions after emercy ftl
fleet_event = {
	id = human_fallen_empires_pirate.51
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
	}

	immediate = {
		#	log = "pirate fleet emercy ftl"
		clear_fleet_actions = this
	}
}

# pirate gain resurces after kill station
country_event = {
	id = human_fallen_empires_pirate.52
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = human_fallen_empires_pirate
		exists = fromfromfrom
		fromfromfrom = {
			or = {
				is_ship_size = wormhole_station
				is_ship_size = research_station
				is_ship_size = mining_station
				is_ship_size = observation_station
				is_ship_size = outpost_station
			}
		}
	}

	immediate = {
		from = {
			set_timed_country_flag = {
				flag = human_fallen_empires_attacked_by_pirate
				days = 365
			}
		}
		add_minerals = 90
		add_energy = 10
		add_physics_research = 5
		add_society_research = 5
		add_engineering_research = 5
		#log = "pirate kill station"
	}
}

# pirate bombard colony
planet_event = {
	id = human_fallen_empires_pirate.53
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		num_pops > 0
		exists = owner
		exists = from
		from = {
			is_country_type = human_fallen_empires_pirate
		}
	}

	immediate = {
		log = "pirate bombarding on [Root.GetStarName]"
		owner = {
			set_timed_country_flag = {
				flag = human_fallen_empires_pirate_attacked
				days = 365
			}
		}
		from = {
			add_minerals = 50
			add_energy = 10
			add_physics_research = 5
			add_society_research = 5
			add_engineering_research = 5
			if = {
				limit = {
					any_owned_planet = {
						free_pop_tiles > 0
					}
				}
				random_owned_planet = {
					limit = {
						free_pop_tiles > 0
					}
					save_event_target_as = human_fallen_empires_pirate_planet
				}
				root = {
					random_owned_pop = {
						limit = {
							is_growing = no
							is_sapient = yes
						}
						resettle_pop = {
							pop = this
							planet = event_target:human_fallen_empires_pirate_planet
						}
					}
				}
			}
		}
		add_modifier = {
			modifier = human_fallen_empires_pirate_ravaged_planet
			days = @human_fallen_empires_pirate_ravaged_planet_time
		}
		random_tile = {
			limit = {
				has_building = yes
			}
			set_ruined = yes
		}
	}
}

# clear action on comand for ai for on_ship_ordered
ship_event = {
	id = human_fallen_empires_pirate.54
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		always = no
		exists = owner
		owner = {
			is_country_type = human_fallen_empires_pirate
		}
		is_ship_class = shipclass_military
		# fleet = {
		# 	not = {
		# 		has_fleet_flag = human_fallen_empires_clear_action_on_order
		# 	}
		# }
	}

	immediate = {
		log = "clear ship order by ai comand owner [Owner.GetName] location [This.GetStarName]"
		fleet = {
			#set_timed_fleet_flag = { flag = human_fallen_empires_clear_action_on_order days = 365 }
			clear_fleet_actions = this
		}
	}
}

# pirate diplomacy 100-150

# start event diplomacy
country_event = {
	id = human_fallen_empires_pirate.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		exists = from
		from = {
			is_country_type = human_fallen_empires_pirate
		}
		not = {
			has_country_flag = human_fallen_empires_pirate.101.block
		}
	}

	immediate = {
		from = {
			save_event_target_as = human_fallen_empires_pirate_country
		}
		country_event = { id = human_fallen_empires_pirate.101 }
		# set_country_flag = human_fallen_empires_pirate.101.block remove due game's bug
	}
}

# pirate diplomacy main menu
country_event = {
	id = human_fallen_empires_pirate.101
	title = TRANSMISSION
	desc = {
		trigger = {
			# start
			success_text = {
				text = human_fallen_empires_pirate.101.desc.0
				human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
			}
			# raid
			success_text = {
				text = human_fallen_empires_pirate.101.raid_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.raid_menu
				human_fallen_empires_trigger_exists_any_event_target = yes
			}
			success_text = {
				text = human_fallen_empires_pirate.101.raid_menu.desc.1
				has_country_flag = human_fallen_empires_pirate.101.raid_menu
				human_fallen_empires_trigger_exists_any_event_target = no
			}
			# traid
			success_text = {
				text = human_fallen_empires_pirate.101.traid_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.traid_menu
			}
			# slave
			success_text = {
				text = human_fallen_empires_pirate.101.slave_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.slave_menu
				human_fallen_empires_trigger_exists_any_slave_target = no
			}
			success_text = {
				text = human_fallen_empires_pirate.101.slave_menu.desc.1
				has_country_flag = human_fallen_empires_pirate.101.slave_menu
				human_fallen_empires_trigger_exists_any_slave_target = yes
			}
			# casino
			success_text = {
				text = human_fallen_empires_pirate.101.casino_menu.desc.0
				has_country_flag = human_fallen_empires_pirate.101.casino_menu
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	force_open = yes

	picture_event_data = {
		portrait = event_target:human_fallen_empires_pirate_country
		room = human_fallen_empires_pirate_room
	}

	after = {
		remove_country_flag = human_fallen_empires_pirate.101.block
	}

	# pay for protect
	option = {
		name = human_fallen_empires_pirate.101.0
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		allow = {
			# выполняется если тру
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.0.tooltip_fail
				not = {
					has_opinion_modifier = {
						who = event_target:human_fallen_empires_pirate_country
						modifier = human_fallen_empires_opinion_pirate_pay_for_protect
					}
				}
			}
			energy > 500
			minerals > 500
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.0.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			add_opinion_modifier = {
				who = event_target:human_fallen_empires_pirate_country
				modifier = human_fallen_empires_opinion_pirate_pay_for_protect
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = root
					modifier = human_fallen_empires_opinion_pirate_pay_for_protect
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	# pay for prior target
	option = {
		name = human_fallen_empires_pirate.101.1
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		hidden_effect = {
			#	human_fallen_empires_effect_clear_event_target = yes
			every_country = {
				limit = {
					is_country_type = default
					has_communications = root
					is_at_war_with = root
					nor = {
						is_country = root
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
				human_fallen_empires_effect_save_event_target = yes
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						is_rival = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_pay_for_protect
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						is_domineering_to = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						is_hostile_to = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						is_dismissive_to = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						is_unfriendly_to = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						is_threatened_to = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			if = {
				limit = {
					human_fallen_empires_trigger_exists_all_event_targets = no
				}
				every_country = {
					limit = {
						is_country_type = default
						has_communications = root
						nor = {
							is_country = root
							has_opinion_modifier = {
								who = event_target:human_fallen_empires_pirate_country
								modifier = human_fallen_empires_opinion_pirate_prior_target
							}
						}
					}
					human_fallen_empires_effect_save_event_target = yes
				}
			}
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.raid_menu
			country_event = { id = human_fallen_empires_pirate.101 }
		}
	}
	# select target menu
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_0
		}
		allow = {
			energy > 500
			minerals > 500
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_pay_for_protect
				not = {
					event_target:human_fallen_empires_event_target_0 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_0 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.0.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_0 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_0
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_1
		}
		allow = {
			energy > 500
			minerals > 500
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_pay_for_protect
				not = {
					event_target:human_fallen_empires_event_target_1 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_1 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.1.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_1 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_1
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_2
		}
		allow = {
			energy > 500
			minerals > 500
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_pay_for_protect
				not = {
					event_target:human_fallen_empires_event_target_2 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_2 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.2.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_2 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_2
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_3
		}
		allow = {
			energy > 500
			minerals > 500
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_pay_for_protect
				not = {
					event_target:human_fallen_empires_event_target_3 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_3 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.3.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_3 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_3
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_4
		}
		allow = {
			energy > 500
			minerals > 500
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_pay_for_protect
				not = {
					event_target:human_fallen_empires_event_target_4 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_4 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.4.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_4 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_4
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.raid_menu.5
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.raid_menu
			exists = event_target:human_fallen_empires_event_target_5
		}
		allow = {
			energy > 500
			minerals > 500
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_pay_for_protect
				not = {
					event_target:human_fallen_empires_event_target_5 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_pay_for_protect
						}
					}
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.raid_menu.fail_prior_target
				not = {
					event_target:human_fallen_empires_event_target_5 = {
						has_opinion_modifier = {
							who = event_target:human_fallen_empires_pirate_country
							modifier = human_fallen_empires_opinion_pirate_prior_target
						}
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.raid_menu.5.response

		add_energy = -500
		add_minerals = -500
		event_target:human_fallen_empires_pirate_country = {
			add_energy = 500
			add_minerals = 500
		}
		hidden_effect = {
			event_target:human_fallen_empires_event_target_5 = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_pirate_country
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
			}
			event_target:human_fallen_empires_pirate_country = {
				add_opinion_modifier = {
					who = event_target:human_fallen_empires_event_target_5
					modifier = human_fallen_empires_opinion_pirate_prior_target
				}
				every_owned_fleet = {
					clear_fleet_actions = this
					fleet_event = { id = human_fallen_empires_pirate.50 }
				}
			}
		}
	}
	# traid menu
	option = {
		name = human_fallen_empires_pirate.101.2
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.traid_menu
			country_event = { id = human_fallen_empires_pirate.101 }
		}
	}
	# energy for minerals
	option = {
		name = human_fallen_empires_pirate.101.traid_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.traid_menu
		}
		allow = {
			minerals > 150
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy > 100
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.traid_menu.0.response

		add_energy = 100
		add_minerals = -150
		event_target:human_fallen_empires_pirate_country = {
			add_energy = -100
			add_minerals = 150
		}
	}
	# buy slave
	option = {
		name = human_fallen_empires_pirate.101.traid_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.traid_menu
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.slave_menu
			event_target:human_fallen_empires_pirate_country = {
				human_fallen_empires_effect_save_slave_target = yes
			}
			country_event = { id = human_fallen_empires_pirate.101 }
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			event_target:human_fallen_empires_pirate_country = {
				human_fallen_empires_trigger_is_egalitarian = yes
			}
		}
		human_fallen_empires_effect_egalitarian_attraction_low = yes
		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.0.response
	}
	# select slave menu
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_0
		}
		allow = {
			energy > @human_fallen_empires_pirate_slave_cost
			minerals > @human_fallen_empires_pirate_slave_cost
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_0
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.1.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_0
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_1
		}
		allow = {
			energy > @human_fallen_empires_pirate_slave_cost
			minerals > @human_fallen_empires_pirate_slave_cost
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_1
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.2.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_1
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_2
		}
		allow = {
			energy > @human_fallen_empires_pirate_slave_cost
			minerals > @human_fallen_empires_pirate_slave_cost
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_2
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.3.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_2
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_3
		}
		allow = {
			energy > @human_fallen_empires_pirate_slave_cost
			minerals > @human_fallen_empires_pirate_slave_cost
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_3
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.4.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_3
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.5
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_4
		}
		allow = {
			energy > @human_fallen_empires_pirate_slave_cost
			minerals > @human_fallen_empires_pirate_slave_cost
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_4
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.5.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_4
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
	}
	option = {
		name = human_fallen_empires_pirate.101.slave_menu.6
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.slave_menu
			exists = event_target:human_fallen_empires_slave_target_5
		}
		allow = {
			energy > @human_fallen_empires_pirate_slave_cost
			minerals > @human_fallen_empires_pirate_slave_cost
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_space
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.slave_menu.fail_havent_slave
				event_target:human_fallen_empires_pirate_country = {
					any_owned_pop = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_5
					}
				}
			}
		}

		is_dialog_only = yes
		response_text = human_fallen_empires_pirate.101.slave_menu.6.response

		add_energy = @human_fallen_empires_pirate_slave_cost_minus
		add_minerals = @human_fallen_empires_pirate_slave_cost_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_pirate_slave_cost
			add_minerals = @human_fallen_empires_pirate_slave_cost
		}
		hidden_effect = {
			event_target:human_fallen_empires_pirate_country = {
				random_owned_pop = {
					limit = {
						is_exact_same_species = event_target:human_fallen_empires_slave_target_5
					}
					save_event_target_as = human_fallen_empires_settle_pop_target
				}
			}
		}
		human_fallen_empires_effect_settle_pop = yes
		human_fallen_empires_effect_settle_pop_from_slavery_buff = yes
	}
	# casino menu
	option = {
		name = human_fallen_empires_pirate.101.3
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = no
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			set_country_flag = human_fallen_empires_pirate.101.casino_menu
			country_event = { id = human_fallen_empires_pirate.101 }
		}
	}
	# select bet
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.0
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy > @human_fallen_empires_blackjack_bet_0
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy > @human_fallen_empires_blackjack_bet_0
				}
			}
		}
		add_energy = @human_fallen_empires_blackjack_bet_0_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_blackjack_bet_0_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_0
			save_event_target_as = human_fallen_empires_blackjack_target_0
			event_target:human_fallen_empires_pirate_country = {
				set_country_flag = human_fallen_empires_blackjack_bet_0
				save_event_target_as = human_fallen_empires_blackjack_target_1
				save_event_target_as = human_fallen_empires_blackjack_target_enemy
			}
			human_fallen_empires_effect_blackjack_turn_0 = yes
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.1
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy > @human_fallen_empires_blackjack_bet_1
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy > @human_fallen_empires_blackjack_bet_1
				}
			}
		}
		add_energy = @human_fallen_empires_blackjack_bet_1_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_blackjack_bet_1_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_1
			save_event_target_as = human_fallen_empires_blackjack_target_0
			event_target:human_fallen_empires_pirate_country = {
				set_country_flag = human_fallen_empires_blackjack_bet_1
				save_event_target_as = human_fallen_empires_blackjack_target_1
				save_event_target_as = human_fallen_empires_blackjack_target_enemy
			}
			human_fallen_empires_effect_blackjack_turn_0 = yes
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.2
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy > @human_fallen_empires_blackjack_bet_2
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy > @human_fallen_empires_blackjack_bet_2
				}
			}
		}
		add_energy = @human_fallen_empires_blackjack_bet_2_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_blackjack_bet_2_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_2
			save_event_target_as = human_fallen_empires_blackjack_target_0
			event_target:human_fallen_empires_pirate_country = {
				set_country_flag = human_fallen_empires_blackjack_bet_2
				save_event_target_as = human_fallen_empires_blackjack_target_1
				save_event_target_as = human_fallen_empires_blackjack_target_enemy
			}
			human_fallen_empires_effect_blackjack_turn_0 = yes
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.3
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy > @human_fallen_empires_blackjack_bet_3
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy > @human_fallen_empires_blackjack_bet_3
				}
			}
		}
		add_energy = @human_fallen_empires_blackjack_bet_3_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_blackjack_bet_3_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_3
			save_event_target_as = human_fallen_empires_blackjack_target_0
			event_target:human_fallen_empires_pirate_country = {
				set_country_flag = human_fallen_empires_blackjack_bet_3
				save_event_target_as = human_fallen_empires_blackjack_target_1
				save_event_target_as = human_fallen_empires_blackjack_target_enemy
			}
			human_fallen_empires_effect_blackjack_turn_0 = yes
		}
	}
	option = {
		name = human_fallen_empires_pirate.101.casino_menu.bet.4
		trigger = {
			has_country_flag = human_fallen_empires_pirate.101.casino_menu
		}
		allow = {
			energy > @human_fallen_empires_blackjack_bet_4
			custom_tooltip = {
				fail_text = human_fallen_empires_pirate.101.traid_menu.fail
				event_target:human_fallen_empires_pirate_country = {
					energy > @human_fallen_empires_blackjack_bet_4
				}
			}
		}
		add_energy = @human_fallen_empires_blackjack_bet_4_minus
		event_target:human_fallen_empires_pirate_country = {
			add_energy = @human_fallen_empires_blackjack_bet_4_minus
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_bet_4
			save_event_target_as = human_fallen_empires_blackjack_target_0
			event_target:human_fallen_empires_pirate_country = {
				set_country_flag = human_fallen_empires_blackjack_bet_4
				save_event_target_as = human_fallen_empires_blackjack_target_1
				save_event_target_as = human_fallen_empires_blackjack_target_enemy
			}
			human_fallen_empires_effect_blackjack_turn_0 = yes
		}
	}
	# return
	option = {
		name = modmenu_return
		trigger = {
			human_fallen_empires_trigger_pirate_diplomacy_any_menu = yes
		}
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
			country_event = { id = human_fallen_empires_pirate.101 }
		}
	}
	# exit
	option = {
		name = human_fallen_empires_end_transmission
		default_hide_option = yes
		hidden_effect = {
			human_fallen_empires_effect_pirate_diplomacy_remove_flags = yes
		}
	}
}

# blackjack event 150 - 200
# main blackjack event
country_event = {
	id = human_fallen_empires_pirate.150
	title = TRANSMISSION
	desc = {
		trigger = {
			success_text = {
				text = "We win!"
				has_country_flag = human_fallen_empires_blackjack_end_win
			}
			success_text = {
				text = "We stay!"
				has_country_flag = human_fallen_empires_blackjack_end_stay
			}
			success_text = {
				text = "We lose!"
				has_country_flag = human_fallen_empires_blackjack_end
				nor = {
					has_country_flag = human_fallen_empires_blackjack_end_win
					has_country_flag = human_fallen_empires_blackjack_end_stay
				}
			}
			text = human_fallen_empires_blackjack_show_my_stats
			text = human_fallen_empires_newline_3
			fail_text = {
				text = human_fallen_empires_blackjack_show_enemy_stats_hide
				has_country_flag = human_fallen_empires_blackjack_end
			}
			success_text = {
				text = human_fallen_empires_blackjack_show_enemy_stats
				has_country_flag = human_fallen_empires_blackjack_end
			}
		}
	}
	diplomatic = yes
	is_triggered_only = yes
	force_open = yes

	picture_event_data = {
		portrait = event_target:human_fallen_empires_blackjack_target_enemy
		planet_background = event_target:human_fallen_empires_blackjack_target_enemy
		graphical_culture = event_target:human_fallen_empires_blackjack_target_enemy
		city_level = event_target:human_fallen_empires_blackjack_target_enemy
		room = event_target:human_fallen_empires_blackjack_target_enemy.ruler
	}

	immediate = {
		if = {
			limit = {
				event_target:human_fallen_empires_blackjack_target_0 = {
					has_country_flag = human_fallen_empires_blackjack_stand
				}
				event_target:human_fallen_empires_blackjack_target_1 = {
					has_country_flag = human_fallen_empires_blackjack_stand
				}
			}
			human_fallen_empires_effect_blackjack_calc_winner = yes
		}
	}

	option = {
		name = "Hit"
		trigger = {
			not = {
				has_country_flag = human_fallen_empires_blackjack_end
			}
		}
		allow = {
			custom_tooltip = {
				text = human_fallen_empires_blackjack_have_21
				check_variable = {
					which = blackjack_calc
					value < 21
				}
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				check_variable = {
					which = blackjack_calc
					value > 16
				}
			}
		}
		hidden_effect = {
			human_fallen_empires_effect_blackjack_get_card = yes
			human_fallen_empires_effect_blackjack_calc_cards = yes
			human_fallen_empires_effect_blackjack_take_cards_in_place = yes
			human_fallen_empires_effect_blackjack_next_turn = yes
		}
	}
	option = {
		name = "Stand"
		trigger = {
			not = {
				has_country_flag = human_fallen_empires_blackjack_end
			}
		}
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0
				check_variable = {
					which = blackjack_calc
					value < 17
				}
			}
		}
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_stand
			human_fallen_empires_effect_blackjack_next_turn = yes
		}
	}
	option = {
		name = "End"
		trigger = {
			has_country_flag = human_fallen_empires_blackjack_end
		}
		ai_chance = {
			factor = 100
		}
		human_fallen_empires_effect_blackjack_calc_bet = yes
		hidden_effect = {
			set_country_flag = human_fallen_empires_blackjack_end_shown
			human_fallen_empires_effect_blackjack_next_turn = yes
		}
	}
	option = {
		name = modmenu_exit
		trigger = {
			always = no
		}
		ai_chance = {
			factor = 0
		}
		hidden_effect = {
			event_target:human_fallen_empires_blackjack_target_0 = {
				human_fallen_empires_effect_blackjack_clean_all = yes
			}
			event_target:human_fallen_empires_blackjack_target_1 = {
				human_fallen_empires_effect_blackjack_clean_all = yes
			}
		}
	}
}

# other pirate related event
# notify then save pops from bases
