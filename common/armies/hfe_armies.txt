#Defensive armies can't transport of the planet
#Garrison armies are created by pops
#maintenance is directly scripted here. 0.25 translates to 0.25 monthly cost (excluding other upkeep modifiers)

# TODO
# hfe_elite_slave_army = {
# 	damage = 1.3
# 	health = 1.3
# 	morale = 1.0
# 	morale_damage = 1.00
# 	collateral_damage = 1.3
# 	war_exhaustion = 0.5
# 	time = 90
# 	maintenance = 0.5
# 	icon_frame = 10
# 	cost = {
# 		minerals = 150
# 	}
# 	prerequisites = {
# 		tech_neural_implants
# 	}
# 	allow = {
# 		has_building = building_slave_processing
# 	}
# 	potential = {
# 		from = {
# 			is_sapient = yes
# 			NOR = {
# 				has_trait = "trait_robotic_1"
# 				has_trait = "trait_robotic_2"
# 				has_trait = "trait_robotic_3"
# 				has_trait = "trait_machine_unit"
# 			}
# 			has_slavery_type = {
# 				country = prev.owner
# 				type = slavery_military
# 			}
# 		}
# 	}
# }

hfe_army_high_mechanicus_bodyguards = {
	defensive = yes
#	is_pop_spawned = yes
	pop_limited = no
	health = 1.1
	damage = 2
	morale = 5
	has_morale = yes
	morale_damage = 1.5
	collateral_damage = 0.25
	war_exhaustion = 1
	icon_frame = 5
	has_species = yes

	resources = {
		category = armies
		cost = {
			trigger = {
				owner = {
					NOT = {
						is_primitive = yes
						is_country_type = primitive
					}
				}
			}
			energy = 500
			food = 30
			alloys = 300
		}
		produces = {
			unity = 1
		}
		upkeep = {
			food = 2
			alloys = 2
			energy = 2
			minerals = 1
		}
	}

	potential = {
		owner = { has_country_flag = hfe_varelse_primitive_0 }
		owner = {
			OR = {
				has_civic = hfe_civic_high_mechanicus
				has_country_flag = high_mechanicus_retained
				is_spiritualist = yes
			}
			NOT = {
				has_civic = hfe_civic_overthrown_mechanicus
				has_country_flag = varelse_fedora_governance
				is_materialist = yes
			}
		}
		OR = {
			planet = { has_planet_flag = colony_beta }
			planet = { is_capital = yes }
		}
	}
	allow = {
		planet = {
			NOT = { # Only one can exist on a planet
				any_planet_army = {
					army_type = hfe_army_high_mechanicus_bodyguards
				}
			}
		}
		FROM = {
			NOT = {
				has_trait = trait_mechanical
				has_trait = trait_machine_unit
				is_robotic = yes
			}
		}
		FROM = {
			OR = {
				has_citizenship_rights = yes
				has_citizenship_type = {
					type = citizenship_full
				}
				is_same_species = owner_main_species
				owner = { is_primitive = yes }
				owner = { is_country_type = primitive }
			}
		}
		owner = { # Can only be re-spawned in peacetime
			is_at_war = no
		}
	}
}

hfe_army_high_mechanicus_zealots = {
	defensive = yes
	damage = 0.4
	health = 0.5
	morale = 5
	morale_damage = 1.5
	icon_frame = 3
	has_species = yes
	is_pop_spawned = yes
	pop_limited = yes
	war_exhaustion = 0.05
	time = 20

	resources = {
		category = armies
		cost = {
			food = 200
		}
		produces = {
			unity = 1
		}
		upkeep = {
			food = 0.5
			alloys = 1
		}
		upkeep = {
			trigger = {
				owner = {
					NOT = {
						is_primitive = yes
						is_country_type = primitive
					}
				}
			}
			minerals = 0.1
			food = 0.5
		}
	}

	potential = {
		owner = { has_country_flag = hfe_varelse_primitive_0 }
		owner = {
			OR = {
				has_civic = hfe_civic_high_mechanicus
				has_country_flag = high_mechanicus_retained
			}
		}
	}
	allow = {
		planet = {
			OR = {
				has_planet_flag = colony_beta
				has_building = hfe_building_mechanicus_cult_temple
			}
		}
		FROM = {
			OR = {
				has_citizenship_rights = yes
				has_citizenship_type = {
					type = citizenship_full
				}
				is_same_species = owner_main_species
				owner = { is_primitive = yes }
				owner = { is_country_type = primitive }
			}
		}
	}
}

hfe_army_mechanicus_godforge_drones = {
	defensive = yes
	is_pop_spawned = yes
	damage = 1.00
	health = 1.5
	morale_damage = 1.00
	collateral_damage = 0.1
	war_exhaustion = 0.0 # No WE from defense armies
	has_morale = no
	icon_frame = 11
	time = 200
	pop_limited = no
	has_species = yes

#	potential = {
#		from = { 
#			has_trait = "trait_mechanical"
#		}
#		owner = {
#			NOT = { has_authority = auth_machine_intelligence }
#		}
#	}

	resources = {
		category = armies
		cost = {
			alloys = 100
		}
		upkeep = {
			trigger = {
				owner = {
					NOT = {
						is_primitive = yes
						is_country_type = primitive
						has_country_flag = hfe_varelse_primitive_0
					}
				}
			}
			alloys = 0.25
		}
		upkeep = {
			trigger = {
				owner = { NOT = { has_country_flag = hfe_varelse_primitive_0 } }
			}
			energy = 2.5
		}
		upkeep = {
			trigger = {
				owner = {
					NOT = {
						is_primitive = yes
						is_country_type = primitive
					}
				}
			}
			energy = 0.1
			minerals = 0.5
		}
	}

	potential = {
		planet = {
			OR = {
				has_planet_flag = colony_beta
				has_building = hfe_building_high_mechanicus_godforge
			}
		}
	}

	allow = {
		OR = {
			owner = { has_country_flag = hfe_varelse_primitive_0 }
			FROM = { has_trait = trait_mechanical }
			FROM = { has_trait = trait_machine_unit }
		}
		owner = { NOT = { has_policy_flag = robots_outlawed } }
	}
}

hfe_army_godforge_core_watch = {
	damage = 1.5
	health = 2.5
	has_morale = no
	morale_damage = 1.5
	collateral_damage = 0.45
	war_exhaustion = 0.9
	time = 120
	has_species = no

	icon_frame = 11

	resources = {
		category = armies
		cost = {
			trigger = {
				NOT = { owner = { has_country_flag = hfe_varelse_primitive_0 } }
			}
			alloys = 300
		}

		cost = {
			energy = 100
			minerals = 100
			alloys = 50
		}

		upkeep = {
			trigger = {
				owner = {
					NOT = {
						has_country_flag = hfe_varelse_primitive_0
						is_primitive = yes
						is_country_type = primitive
					}
				}
			}
			energy = 3
		}
	}

	potential = {
		planet = {
			OR = {
				has_planet_flag = colony_beta
				has_building = hfe_building_high_mechanicus_godforge
			}
		}
	}
	allow = {
		OR = {
			owner = { has_country_flag = hfe_varelse_primitive_0 }
			FROM = {
				has_trait = trait_mechanical
				has_trait = trait_machine_unit
			}
		}
		owner = { NOT = { has_policy_flag = robots_outlawed } }
	}
}