#

# total war cb, need 2 event targets
human_fallen_empires_effect_total_war_declare = {
	if = {
		limit = {
			not = {
				event_target:human_fallen_empires_total_war_attaker = {
					is_at_war_with = event_target:human_fallen_empires_total_war_defender
				}
			}
		}
		event_target:human_fallen_empires_total_war_attaker = {
			declare_war = {
				target = event_target:human_fallen_empires_total_war_defender
				attacker_war_goal = human_fallen_empires_wg_total_war
			}
		}
	}
}

human_fallen_empires_effect_create_vassal = {
	add_threat = {
		who = root
		amount = 1 # scales to pops
	}
	if = {
		limit = {
			owner = {
				is_country = event_target:human_fallen_empires_total_war_loser
			}
		}
		save_event_target_as = human_fallen_empires_planet
		if = {
			limit = {
				any_country = {
					has_country_flag = human_fallen_empires_liberated_country
					num_owned_planets < 4
				}
			}
			random_country = {
				limit = {
					has_country_flag = human_fallen_empires_liberated_country
					num_owned_planets < 4
				}
				event_target:human_fallen_empires_planet = {
					set_owner = prev
					set_controller = prev
				}
			}
		}
		else = {
			create_country = {
				name = random
				authority = random
				civics = random
				released_by_country = root
				released_from_country = event_target:human_fallen_empires_total_war_loser
				species = event_target:human_fallen_empires_total_war_loser
				ethos = root
				flag = random
				type = default
				day_zero_contact = no
				effect = {
					set_timed_country_flag = {
						flag = human_fallen_empires_liberated_country days = 1
					}
					establish_communications_no_message = root
					#establish_communications_no_message = fromfromfrom
					#establish_communications_no_message = parameter:planet.owner
					establish_contact = {
						who = root
						location = event_target:human_fallen_empires_planet
					}
					#establish_contact = { who = fromfromfrom location = parameter:planet }
					#establish_contact = { who = parameter:planet.owner location = parameter:planet }
					event_target:human_fallen_empires_planet = {
						set_owner = prev
						set_controller = prev
						solar_system = {
							every_system_planet = {
								limit = {
									exists = owner
									owner = {
										is_country = event_target:human_fallen_empires_total_war_loser
									}
								}
								set_owner = prevprevprev
								set_controller = prevprevprev
							}
						}
					}
					if = {
						limit = {
							is_country_type = awakened_fallen_empire
						}
						if = {
							limit = {
								is_xenophile = yes
							}
							set_subject_of = {
								who = root
								subject_type = signatory
							}
						}
						else_if = {
							limit = {
								is_xenophobe = yes
							}
							set_subject_of = {
								who = root
								subject_type = thrall
							}
						}
						else_if = {
							limit = {
								is_spiritualist = yes
							}
							set_subject_of = {
								who = root
								subject_type = dominion
							}
						}
						else_if = {
							limit = {
								is_materialist = yes
							}
							set_subject_of = {
								who = root
								subject_type = satellite
							}
						}
					}
					else_if = {
						limit = {
							is_country = event_target:human_fallen_empires_coalition_leader
						}
						set_subject_of = {
							who = root
							subject_type = human_fallen_empires_future_vassal
						}
						#country_remove_ethic = ethic_fanatic_militarist
						#country_add_ethic = ethic_militarist
					}
					else = {
						set_subject_of = {
							who = root
							subject_type = vassal
						}
					}
				}
			}
		}
	}
}