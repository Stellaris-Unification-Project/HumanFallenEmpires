# pirate

# for country
human_fallen_empires_effect_pirate_diplomacy_remove_flags = {
	remove_country_flag = human_fallen_empires_pirate.101.raid_menu
	remove_country_flag = human_fallen_empires_pirate.101.traid_menu
	remove_country_flag = human_fallen_empires_pirate.101.slave_menu
	remove_country_flag = human_fallen_empires_pirate.101.casino_menu
	remove_country_flag = human_fallen_empires_pirate.101.casino_menu.challenge
}

# create pirate
# return event target pirate_band, need event target human_fallen_empires_pirate_target
human_fallen_empires_effect_pirate_init = {
	if = {
		limit = {
			any_system = {
				is_neighbor_of = event_target:human_fallen_empires_pirate_target
				human_fallen_empires_pirate_valid_base_system = yes
			}
		}
		random_system = {
			limit = {
				is_neighbor_of = event_target:human_fallen_empires_pirate_target
				human_fallen_empires_pirate_valid_base_system = yes
			}
			random_system_planet = {
				limit = {
					human_fallen_empires_pirate_valid_base_planet = yes
				}
				human_fallen_empires_effect_pirate_init_country = yes
				human_fallen_empires_effect_pirate_init_base = yes
			}
		}
		else = {
			closest_system = {
				max_steps = 30
				limit = {
					human_fallen_empires_pirate_valid_base_system = yes
				}
				random_system_planet = {
					limit = {
						human_fallen_empires_pirate_valid_base_planet = yes
					}
					human_fallen_empires_effect_pirate_init_country = yes
					human_fallen_empires_effect_pirate_init_base = yes
				}
			}
		}
	}
}

# for planet, asteroid ideally, need event target pirate_band
human_fallen_empires_effect_pirate_init_base = {
	change_pc = pc_human_fallen_empires_pirate_base
	create_colony = {
		owner = event_target:human_fallen_empires_pirate_clan
		species = owner
	}
	if = {
		limit = {
			has_owner = no
		}
		set_owner = event_target:human_fallen_empires_pirate_clan
		log = "pirate base not created, try to set owner"
	}
	# log = "pirate created new base [this.GetName] owner: [owner.GetName] on [This.GetStarName]"
	every_owned_pop = {
		kill_pop = yes
	}
	random_tile = {
		limit = {
			has_building = building_colony_shelter
		}
		remove_building = yes
	}
	set_planet_flag = human_fallen_empires_pirate_base
	human_fallen_empires_effect_create_starbase_outpost_from_planet = yes
	starbase = {
		set_starbase_size = starbase_starport
		set_starbase_module = {
			slot = 1
			module = shipyard
		}
	}
}

human_fallen_empires_effect_pirate_init_country = {
	create_country = {
		name = random
		type = human_fallen_empires_pirate
		species = event_target:human_fallen_empires_pirate_target.species
		name_list = human_fallen_empires_pirate_namelist
		authority = random
		civics = random
		released_from_country = event_target:human_fallen_empires_pirate_target
		ethos = random
		flag = random
		ignore_initial_colony_error = yes
		effect = {
			change_country_flag = {
				colors = {
					dark_grey
					dark_grey
					null
					null
				}
			}
			randomize_flag_symbol = pirate
			add_modifier = {
				modifier = human_fallen_empires_pirate_country_unkeep
				days = -1
			}
			if = {
				limit = {
					is_difficulty > 1
				}
				add_modifier = {
					modifier = human_fallen_empires_pirate_country_insane
					days = -1
				}
			}
			if = {
				limit = {
					is_difficulty = 1
				}
				add_modifier = {
					modifier = human_fallen_empires_pirate_country_hard
					days = -1
				}
			}
			add_modifier = {
				modifier = human_fallen_empires_pirate_country_boost
				days = 3650
			}
			set_graphical_culture = human_fallen_empires_graphical_culture_pirate
			add_minerals = 500
			if = {
				limit = {
					years_passed > 20
				}
				add_minerals = 1000
			}
			if = {
				limit = {
					years_passed > 40
				}
				add_minerals = 1000
			}
			if = {
				limit = {
					years_passed > 60
				}
				add_minerals = 1000
			}
			add_energy = 600
			add_influence = 600
			set_relation_flag = {
				who = event_target:human_fallen_empires_pirate_target
				flag = pirate_relation
			}
			if = {
				limit = {
					has_ethic = ethic_pacifist
				}
				country_remove_ethic = ethic_pacifist
				country_add_ethic = ethic_militarist
			}
			if = {
				limit = {
					has_ethic = ethic_fanatic_pacifist
				}
				country_remove_ethic = ethic_fanatic_pacifist
				country_add_ethic = ethic_fanatic_militarist
			}
			save_event_target_as = pirate_band
			save_event_target_as = human_fallen_empires_pirate_clan
			every_country = {
				limit = {
					is_country_type = primitive
				}
				establish_communications_no_message = prev
				prev = {
					if = {
						limit = {
							is_xenophobe = no
						}
					}
					set_faction_hostility = {
						target = prev
						set_hostile = no
						set_neutral = yes
						set_friendly = no
					}
				}
			}
		}
	}
}

# for country, return 6 event targets of not same species
human_fallen_empires_effect_save_slave_target = {
	every_owned_pop = {
		if = {
			limit = {
				not = {
					exists = event_target:human_fallen_empires_slave_target_0
				}
			}
			save_event_target_as = human_fallen_empires_slave_target_0
			else = {
				if = {
					limit = {
						nor = {
							exists = event_target:human_fallen_empires_slave_target_1
							is_exact_same_species = event_target:human_fallen_empires_slave_target_0
						}
					}
					save_event_target_as = human_fallen_empires_slave_target_1
					else = {
						if = {
							limit = {
								nor = {
									exists = event_target:human_fallen_empires_slave_target_2
									is_exact_same_species = event_target:human_fallen_empires_slave_target_0
									is_exact_same_species = event_target:human_fallen_empires_slave_target_1
								}
							}
							save_event_target_as = human_fallen_empires_slave_target_2
							else = {
								if = {
									limit = {
										nor = {
											exists = event_target:human_fallen_empires_slave_target_3
											is_exact_same_species = event_target:human_fallen_empires_slave_target_0
											is_exact_same_species = event_target:human_fallen_empires_slave_target_1
											is_exact_same_species = event_target:human_fallen_empires_slave_target_2
										}
									}
									save_event_target_as = human_fallen_empires_slave_target_3
									else = {
										if = {
											limit = {
												nor = {
													exists = event_target:human_fallen_empires_slave_target_4
													is_exact_same_species = event_target:human_fallen_empires_slave_target_0
													is_exact_same_species = event_target:human_fallen_empires_slave_target_1
													is_exact_same_species = event_target:human_fallen_empires_slave_target_2
													is_exact_same_species = event_target:human_fallen_empires_slave_target_3
												}
											}
											save_event_target_as = human_fallen_empires_slave_target_4
											else = {
												if = {
													limit = {
														nor = {
															exists = event_target:human_fallen_empires_slave_target_5
															is_exact_same_species = event_target:human_fallen_empires_slave_target_0
															is_exact_same_species = event_target:human_fallen_empires_slave_target_1
															is_exact_same_species = event_target:human_fallen_empires_slave_target_2
															is_exact_same_species = event_target:human_fallen_empires_slave_target_3
															is_exact_same_species = event_target:human_fallen_empires_slave_target_4
														}
													}
													save_event_target_as = human_fallen_empires_slave_target_5
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

# this planet, from bombarder
human_fallen_empires_effect_pirate_ravage_planet = {
	random_tile = {
		limit = {
			has_building = yes
			is_ruined = no
		}
		set_ruined = yes
		# протестить можно ли просто фром
		prev.from = {
			add_minerals = 50
			add_energy = 10
			add_physics_research = 5
			add_society_research = 5
			add_engineering_research = 5
		}
	}
	if = {
		limit = {
			from = {
				any_owned_planet = {
					free_pop_tiles > 0
				}
			}
		}
		random_owned_pop = {
			limit = {
				is_growing = no
				is_sapient = yes
			}
			save_event_target_as = human_fallen_empires_settle_pop_target
		}
		from = {
			human_fallen_empires_effect_settle_pop = yes
		}
	}
	add_modifier = {
		modifier = human_fallen_empires_pirate_ravaged_planet
		days = @human_fallen_empires_pirate_ravaged_planet_time
	}
}
