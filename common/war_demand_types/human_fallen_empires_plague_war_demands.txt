# variables:
# parameters, data containing the specifics, eg which planet we're talking about
# warscore_cost, scripted value, root is target country, amount of warscore required to push this demand
# potential, trigger, root and from are main attackers and defenders, war is fromfrom, decides if this demand is listed
# possible, trigger, root and from are main attackers and defenders, war is fromfrom, fromfromfrom is the target country, decides if this demand can go through
# proposable, trigger, root and from are main attackers and defenders, war is fromfrom, fromfromfrom is the target country, decides if this demand is ok to propose
# demandable, trigger, root and from are main attackers and defenders, war is fromfrom, fromfromfrom is the target country, decides if you can send a peace offer demanding ( not surrendering ) the demand.
# effect, effect, root and main are main attacker and defender, war is fromfrom, fromfromfrom is the target country, effect which executes when the demand is accepted
# execution_order, integer, defines in which order demands are executed, lower is higher priority, having the same execution order will make the first defined one higher prio
# monthly_warscore, a descriptor on monthly wargoal score
#	amount, scripted value, root and from are main attackers and defenders, war is fromfrom, fromfromfrom is the target country
#   valid, trigger, root and from are main attackers and defenders, war is fromfrom, fromfromfrom is the target country

# plague clean
human_fallen_empires_plague_clean = {
	is_conquest_type = yes
	execution_order = 0

	parameters = {
		planet = {
			type = planet
			filter = owned
		}
	}

	warscore_cost = {
		base = 10

		modifier = {
			factor = 2.0
			NOT = {
				parameter:planet.owner = {
					is_same_value = from
				}
			}
		}

		scaled_modifier = {
			scope = parameter:planet
			add = 0.4
			calc = pop_count
		}

		modifier = {
			factor = 1.25
			hidden:parameter:planet = {
				is_capital = yes
			}
		}

		modifier = {
			factor = 0.5
			has_global_flag = human_fallen_empires_plague_lvl_3
		}

		# Ruler Trait - Warlike
		modifier = {
			factor = 0.95
			custom_tooltip = {
				text = "war_demand_trait_warlike"
				exists = ruler
				ruler = { has_trait = trait_ruler_warlike }
			}
		}

		# Ruler Trait - Expansionist
		modifier = {
			factor = 0.9
			custom_tooltip = {
				text = "war_demand_trait_expansionist"
				exists = ruler
				ruler = { has_trait = trait_ruler_expansionist }
			}
		}

		# Tech - Interstellar Campaigns
		modifier = {
			factor = 0.75
			custom_tooltip = {
				text = "war_demand_tech_interstellar_campaigns"
				has_technology = tech_interstellar_campaigns
			}
		}

		# Tech - Galactic Campaigns
		modifier = {
			factor = 0.75
			custom_tooltip = {
				text = "war_demand_tech_galactic_campaigns"
				has_technology = tech_galactic_campaigns
			}
		}
	}

	potential = {
		parameter:planet = {
			has_planet_flag = human_fallen_empires_plague_planet
		#	NOT = { is_planet_class = pc_habitat }
		}
		custom_tooltip = {
			fail_text = "war_demand_cede_planet_no_vassals"
			OR = {
				is_subject = no
				NOT = {
					overlord = {
						is_same_value = from
					}
				}
			}
		}
		parameter:planet = {
			owner = {
				OR = {
					AND = {
						exists = fromfrom
						from = {
							from = {
								is_war_participant = {
									who = prevprev
									side = prev
								}
							}
						}
					}
					AND = {
						NOT = { exists = fromfrom }
						would_join_war = {
							attacker = root
							defender = from
							side = from
						}
					}

				}
			}
		}
	}

	possible = {
		hidden_trigger = {
			parameter:planet.owner = {
				OR = {
					war_demand_counter = {
						type = num_country_wargoals
						value < 1
					}
					war_demand_counter = {
						type = num_owned_planets
						value > 1
					}
				}
			}
		}
	}

	proposable = {
		custom_tooltip = {
			fail_text = "war_demand_war_philosophy"
			has_policy_flag = unrestricted_wars
		}

		hidden:parameter:planet = {
			custom_tooltip = {
				fail_text = "war_demand_cede_or_liberate"
				war_demand_counter = {
					type = ceded_or_liberated
					value < 1
				}
			}
		}
	}

	demandable = {
		custom_tooltip = {
			fail_text = "war_demand_cede_planet_not_under_our_control"
			parameter:planet = {
				controller = {
					OR = {
						is_country = parameter:planet.owner
						fromfrom = {
							is_war_participant = {
								who = prev
								side = from
							}
						}
					}
				}
			}
		}
	}

	effect = {
		parameter:planet = {
			hidden_effect = {
				add_threat = {
					who = fromfromfrom
					amount = 1 # scales to pops
				}

				# every_owned_pop = {
				# 	limit = {
				# 		is_robot_pop = no
				# 		is_sapient = yes
				# 		NOT = { has_trait = "trait_hive_mind" }
				# 	}
				# 	every_country = {
				# 		limit = {
				# 			has_communications = fromfromfrom
				# 			NOT = { is_country = fromfromfrom }
				# 			NOT = { is_same_species = PREV }
				# 		}
				# 		add_opinion_modifier = { who = fromfromfrom modifier = opinion_genocidal }
				# 	}
				# 	every_country = {
				# 		limit = {
				# 			has_communications = fromfromfrom
				# 			NOT = { is_country = fromfromfrom }
				# 			is_same_species = PREV
				# 		}
				# 		add_opinion_modifier = { who = fromfromfrom modifier = opinion_genocidal_our_species }
				# 	}
				# }
			}
			destroy_colony = { keep_buildings = no }
		}
	}

	counters = {
		num_owned_planets = {
			context = parameter:planet.owner
			value = {
				base = -1
			}
		}
		ceded_or_liberated = {
			context = parameter:planet
			value = {
				base = 1
			}
		}
	}

	ai_weight = {
		base = 11

		modifier = {
			factor = 1.5
			has_global_flag = human_fallen_empires_plague_lvl_3
		}

		scaled_modifier = {
			scope = parameter:planet
			div = 2
			calc = planet_distance_empire
		}
	}

	AI_invasion_target = yes
}
