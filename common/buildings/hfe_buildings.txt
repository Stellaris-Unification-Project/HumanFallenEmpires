#

hfe_building_terraformer = {
	icon = building_great_pyramid
	base_buildtime = @fetime
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = yes
	category = research
	potential = {
		exists = owner
		owner = { is_gestalt = no }
	}
	destroy_trigger = {
		exists = owner
		owner = { is_gestalt = yes }
	}
	convert_to = {
		hfe_building_terraformer_machine
		hfe_building_terraformer_machine_rogue_servitor
		hfe_building_terraformer_hive_mind
	}
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 4
		}
	}
	country_modifier = {
		job_hfe_job_terraformer_add = 1
	}
	planet_modifier = {
		job_hfe_job_terraformer_add = 4
	}
}

hfe_building_terraformer_machine = {
	icon = building_great_pyramid
	base_buildtime = @fetime
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = yes
	category = research
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 4
		}
	}
	potential = {
		exists = owner
		owner = { 
			is_machine_empire = yes
			NOT = { has_valid_civic = civic_machine_servitor }
		}
	}
	destroy_trigger = {
		exists = owner
		owner = {
			OR = {
				is_machine_empire = no
				has_valid_civic = civic_machine_servitor
			}
		}
	}
	convert_to = {
		hfe_building_terraformer
		hfe_building_terraformer_machine_rogue_servitor
		hfe_building_terraformer_hive_mind
	}
	country_modifier = {
		job_hfe_job_terraformer_machine_add = 1
	}
	planet_modifier = {
		job_hfe_job_terraformer_machine_add = 4
	}
}

hfe_building_terraformer_machine_rogue_servitor = {
	icon = building_great_pyramid
	base_buildtime = @fetime
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = yes
	category = research
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 4
		}
	}
	potential = {
		exists = owner
		owner = {
			is_machine_empire = yes
			has_valid_civic = civic_machine_servitor
		}
	}
	destroy_trigger = {
		exists = owner
		owner = {
			is_machine_empire = yes
			has_valid_civic = civic_machine_servitor
		}
	}
	convert_to = {
		hfe_building_terraformer
		hfe_building_terraformer_machine
		hfe_building_terraformer_hive_mind
	}
	country_modifier = {
		job_hfe_job_terraformer_machine_rogue_servitor_add = 1
	}
	planet_modifier = {
		job_hfe_job_terraformer_machine_rogue_servitor_add = 4
	}
}

hfe_building_terraformer_hive_mind = {
	icon = building_great_pyramid
	base_buildtime = @fetime
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = yes
	category = research
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 4
		}
	}
	potential = {
		exists = owner
		owner = {
			is_hive_empire = yes
		}
	}
	destroy_trigger = {
		exists = owner
		owner = {
			is_hive_empire = no
		}
	}
	convert_to = {
		hfe_building_terraformer
		hfe_building_terraformer_machine
		hfe_building_terraformer_machine_rogue_servitor
	}
	country_modifier = {
		job_hfe_job_terraformer_hive_mind_add = 1
	}
	planet_modifier = {
		job_hfe_job_terraformer_hive_mind_add = 4
	}
}

hfe_building_virtual = {
	icon = building_virtual_entertainment_studios
	base_buildtime = @fetime
	can_demolish = no
	can_be_ruined = no
	can_be_disabled = yes
	category = amenity
	resources = {
		category = planet_buildings
		upkeep = {
			energy = 4
		}
	}
}

# hfe_building_assimilator = {
# 	icon = building_great_pyramid
# 	base_buildtime = @fetime	# For repair
# 	cost = {
# 		minerals = @fecost	# For repair
# 	}
# 	is_listed = no
# 	ai_replace = no
# 	#event_building = yes
# 	produced_resources = {
# 		unity = 1
# 	}
# 	active = {
# 		hfe_trigger_assimilator_pop_valid_with_ai_block = yes
# 	}
# }

# hfe_building_crio = {
# 	icon = hfe_thoth_module_science
# 	base_buildtime = @fetime	# For repair
# 	cost = {
# 		minerals = @fecost	# For repair
# 	}
# 	is_listed = no
# 	ai_replace = no
# 	#event_building = yes
# 	planet_modifier_with_pop_trigger = {
# 		key = hfe_building_crio
# 		potential = {
# 			exists = tile
# 			tile = {
# 				has_building = hfe_building_crio
# 				is_ruined = no
# 			}
# 		}
# 		modifier = {
# 			pop_consumer_goods_mult = -1
# 			pop_consumer_goods_add = -1
# 		}
# 	}
# }

hfe_building_thoth_module_energy = {
	icon = hfe_building_thoth_module_energy
	can_be_ruined = no
	base_buildtime = 60
	base_cap_amount = 1
	resources = {
		category = planet_buildings
		produces = {
			energy = 5
		}
	}
	planet_modifier = {
		planet_jobs_energy_produces_mult = 0.2
	}
	potential = {
		exists = owner
		owner = {
			check_variable = {
				which = hfe_building_thoth_module_energy
				value > 0
			}
		}
	}
	on_queued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_energy
				value = -1
			}
		}
	}
	on_unqueued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_energy
				value = 1
			}
		}
	}
}

hfe_building_thoth_module_mineral = {
	icon = hfe_building_thoth_module_mineral
	can_be_ruined = no
	base_buildtime = 60
	base_cap_amount = 1
	resources = {
		category = planet_buildings
		produces = {
			minerals = 5
		}
	}
	planet_modifier = {
		planet_jobs_minerals_produces_mult = 0.2
	}
	potential = {
		exists = owner
		owner = {
			check_variable = {
				which = hfe_building_thoth_module_mineral
				value > 0
			}
		}
	}
	on_queued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_mineral
				value = -1
			}
		}
	}
	on_unqueued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_mineral
				value = 1
			}
		}
	}
}

hfe_building_thoth_module_food = {
	icon = hfe_building_thoth_module_food
	can_be_ruined = no
	base_buildtime = 60
	base_cap_amount = 1
	resources = {
		category = planet_buildings
		produces = {
			food = 5
		}
	}
	planet_modifier = {
		planet_jobs_food_produces_mult = 0.2
	}
	potential = {
		exists = owner
		owner = {
			check_variable = {
				which = hfe_building_thoth_module_food
				value > 0
			}
		}
	}
	on_queued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_food
				value = -1
			}
		}
	}
	on_unqueued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_food
				value = 1
			}
		}
	}
}

hfe_building_thoth_module_science = {
	icon = hfe_building_thoth_module_science
	can_be_ruined = no
	base_buildtime = 60
	base_cap_amount = 1
	resources = {
		category = planet_buildings
		produces = {
			engineering_research = 2
			physics_research = 2
			society_research = 2
		}
	}
	planet_modifier = {
		planet_jobs_physics_research_produces_mult = 0.2
		planet_jobs_society_research_produces_mult = 0.2
		planet_jobs_engineering_research_produces_mult = 0.2
	}
	potential = {
		exists = owner
		owner = {
			check_variable = {
				which = hfe_building_thoth_module_science
				value > 0
			}
		}
	}
	on_queued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_science
				value = -1
			}
		}
	}
	on_unqueued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_science
				value = 1
			}
		}
	}
}

hfe_building_thoth_module_industry = {
	icon = hfe_building_thoth_module_industry
	can_be_ruined = no
	base_buildtime = 60
	base_cap_amount = 1
	resources = {
		category = planet_buildings
		produces = {
			consumer_goods = 1
			alloys = 1
		}
	}
	planet_modifier = {
		planet_jobs_alloys_produces_mult = 0.15
		planet_jobs_consumer_goods_produces_mult = 0.15
	}
	potential = {
		exists = owner
		owner = {
			check_variable = {
				which = hfe_building_thoth_module_industry
				value > 0
			}
		}
	}
	on_queued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_industry
				value = -1
			}
		}
	}
	on_unqueued = {
		owner = {
			change_variable = {
				which = hfe_building_thoth_module_industry
				value = 1
			}
		}
	}
}

hfe_building_high_mechanicus_godforge = {
	icon = building_nano_forge
	base_cap_amount = 1
	base_buildtime = 1
	can_build = no
	can_be_disabled = yes
	can_demolish = no
	can_be_ruined = no
	add_to_first_building_slot = yes
	planetary_ftl_inhibitor = yes
	category = manufacturing
	
	potential = {
		has_planet_flag = hfe_varelse_colony
		owner = { has_country_flag = hfe_varelse }
		OR = {
			owner = { has_country_flag = hfe_varelse_primitive_0 }
			owner = { has_country_flag = high_mechanicus_retained }
			owner = { has_country_flag = high_mechanicus_overthrown }
		}
	}

	allow = {
		has_planet_flag = hfe_varelse_colony
		OR = {
			owner = { has_country_flag = hfe_varelse_primitive_0 }
			owner = { has_country_flag = high_mechanicus_retained }
			owner = { has_country_flag = high_mechanicus_overthrown }
		}
		owner = { is_country_type = primitive }
	}
	
	triggered_planet_modifier = {
		potential = {
			OR = {
				owner = { is_country_type = primitive }
				owner = { has_country_flag = hfe_varelse_primitive_0 }
				owner = { has_country_flag = high_mechanicus_retained }
				owner = { has_country_flag = varelse_fedora_governance }
#				owner = { has_government = hfe_gov_high_mechanicus }
			}
			NOT = {
				owner = { has_ethic = ethic_gestalt_consciousness }
			}
		}
		modifier = {
			job_hfe_job_godforger_primitive_add = 1
			job_primitive_laborer_add = 1
			job_primitive_priest_add = 2
			job_primitive_priest_2_add = 1
		}
	}

	triggered_planet_modifier = {
		potential = {
			NOT = { owner = { has_country_flag = hfe_varelse_primitive_0 } }
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		job_foundry_per_pop = 0.1
		job_miner_per_pop = 0.1
	}

	triggered_planet_modifier = {
		potential = {
			owner = { has_ethic = ethic_gestalt_consciousness }
		}
		modifier = {
			job_alloy_drone_per_pop = 0.1
			job_mining_drone_per_pop = 0.05
		}
	}

	resources = {
		category = planet_buildings
		produces = {
			trigger = {
				owner = {
					OR = {
						has_country_flag = hfe_varelse_primitive_0
						has_country_flag = high_mechanicus_retained
						has_country_flag = varelse_fedora_governance
					}
				}
			}
			alloys = 30
			consumer_goods = 50
			food = 50
			engineering_research = 10
		}
		produces = {
			trigger = {
				NOT = {
					has_country_flag = hfe_varelse_primitive_0
				}
			}
		}
		cost = {
			minerals = 10000
			alloys = 1000
		}
		upkeep = {
			trigger = {
				owner = {
					OR = {
						is_ai = no
						NOT = { owner = { has_country_flag = hfe_varelse_primitive_0 } }
					}
				}
			}
			minerals = 50
			energy = 25
		}
	}
		
	upgrades = {
	}

	ai_resource_production = {
#		# This is meant to keep the Varelse Hegemony alive
#		$ because it has many more Pops than a Primitive should
		trigger = { always = yes }
		minerals = 20
		energy = 20
		consumer_goods = 5
		engineering_research = 20
	}

	ai_weight = {
		factor = 999
	}
}

hfe_building_high_mechanicus_stronghold = {
	icon = building_empyrean_shrine
	base_cap_amount = 1
	base_buildtime = 1
	can_build = no
	can_be_disabled = no
	can_demolish = no
	can_be_ruined = no
	add_to_first_building_slot = yes
	planetary_ftl_inhibitor = yes
	category = government

	potential = {
		has_country_flag = hfe_varelse_primitive_0
	}

	destroy_trigger = {
		owner = {
			NOT = {
				has_country_flag = hfe_varelse_primitive_0
				has_country_flag = high_mechanicus_retained
				has_country_flag = varelse_fedora_governance
			}
		}
	}

	triggered_planet_modifier = {
		potential = {
			has_country_flag = hfe_varelse_primitive_0
			NOT = { owner = { has_country_flag = varelse_fedora_governance } }
		}
		modifier = {
			job_mechanicus_bodyguard_add = 1
			job_mechanicus_cultist_add = 5
		}
	}

	triggered_planet_modifier = {
		potential = {
			
		}
	}

	convert_to = {
		building_temple
		building_luxury_residence
		building_drone_storage
	}
}